var wcffObj=null;!function($){var a=function(){this.request=null,this.response=null,this.ajaxFlaQ=!0,this.activeField=null,this.pricingRules=[],this.feeRules=[],this.fieldRules=[],this.colorImage=[],this.val_error={message:"",elem:$(""),flg:!1},this.postSubmit=!1,this.mediaFrame=null,this.draggedField=null,this.emptyNotice=$("#wcff-empty-field-set"),this.placeHolder=$("#wcff-add-field-placeholder"),this.activeRow=null,this.mask=null,this.target=null,this.dirtyFields={},this.configWidgets={},this.searchTimer=null,this.fields={},this.dropZone=null,this.isMouseDown=!1,this.targetDropZone=null,this.targetDropZoneOffsetLeft=0,this.layout={},this.layoutFieldsKeys=[],this.mapping_grid=null,this.currentWccvfSearchField=null,this.currentVariation=null,this.currentProduct=null,this.currentPopup=null,this.wccvfPosts=null,this.currentProductSearchField=null,this.initialize=function(){this.registerEvents(),this.mask=new b,$("#wcff_layout_meta").length>0?(this.layout=JSON.parse($("#wcff_layout_meta").val()),this.layout.columns?Array.isArray(this.layout.columns)&&(this.layout.columns={}):(this.layout.columns={},this.layout.rows=[])):this.layout=[],("wccaf"==wcff_var.current_page||"wccvf"==wcff_var.current_page||"wcccf"==wcff_var.current_page)&&($("#toplevel_page_edit-post_type-wccpf").removeClass("wp-not-current-submenu").addClass("wp-has-current-submenu"),$("#toplevel_page_edit-post_type-wccpf > a").removeClass("wp-not-current-submenu").addClass("wp-has-current-submenu"),"wccvf"==wcff_var.current_page&&$("#toplevel_page_edit-post_type-wccpf").find("> ul > li:nth-child(3)").addClass("current"))},this.registerEvents=function(){$(document).click(function(a){$("ul.wcff-variation-config-popup").hide(),$("div.wcff-target-selector").hide()}),$(document).keyup(function(a){27==a.keyCode&&($("ul.wcff-variation-config-popup").hide(),wcffObj.currentWccvfSearchField&&(wcffObj.mapping_grid.isReloading=!0,wcffObj.mapping_grid.prepareRecords(wcffObj.mapping_grid.records)))}),$(document).on("click","div.variation-config-ghost-back",this,function(a){a.data.currentWccvfSearchField&&(a.data.mapping_grid.isReloading=!0,a.data.mapping_grid.prepareRecords(a.data.mapping_grid.records)),$("ul.wcff-variation-config-popup").hide(),$("div.wcff-variation-mapper-for-variation").css("z-index","9"),a.data.currentPopup=null,a.data.currentProduct=null,a.data.currentVariation=null,a.data.currentWccvfSearchField=null,$(this).remove()}),$(document).on("click","ul.wcff-variation-config-popup, div.wcff-target-selector, td.condition_value_td, input.wcff-field-key-edit-txt",function(a){a.stopPropagation()}),$(document).on("dragstart","#wcff-fields-select-container a.wcff-drag-field",this,function(a){a.data.draggedField=$(a.target),a.data.placeHolder.addClass("dropover")}),$(document).on("dragend","#wcff-fields-select-container a.wcff-drag-field",this,function(a){a.data.draggedField=null,a.data.placeHolder.removeClass("dropover")}),$(document).on("dragenter dragover dragend","#wcff-add-field-placeholder",function(a){a.preventDefault(),a.stopPropagation()}),$(document).on("drop dragdrop","#wcff-add-field-placeholder",this,function(a){a.stopPropagation(),a.data.dropNewField()}),$(document).on("dragstart",".wcff-meta-row.active",function(a){return a.preventDefault(),!1}),$(document).on("dragover",".wcff-meta-row",this,function(a){""!=a.data.draggedField&&($(a.currentTarget).is(":first-child")&&$(a.currentTarget).outerHeight()/2+a.clientY>$(a.currentTarget).offset().top?$(a.currentTarget).before(a.data.placeHolder):$(a.currentTarget).after(a.data.placeHolder))}),$(document).on("dragstart","#wcff-layout-designer-field-list > a",this,function(a){a.data.draggedField=$(a.target),a.data.constructDropZone()}),$(document).on("dragend","#wcff-layout-designer-field-list > a",this,function(a){a.data.destructDropZone()}),$(document).on("dragenter dragover dragend","div.wcff-layout-form-row > div",function(a){a.preventDefault(),a.stopPropagation()}),$(document).on("drop dragdrop","div.wcff-layout-form-row > div",this,function(a){if(a.stopPropagation(),a.data.draggedField){var b=a.data.fields[a.data.draggedField.attr("data-fkey")];b.label_alignment=$("input[name=wcff_label_alignment_radio]:checked").val(),a.data.prepareRequest("GET","render_field",{meta:b},a.data.activeRow),a.data.dock(),a.data.dropZone=$(this),a.data.dropZone.removeClass().addClass("dropped")}}),$(document).on("dragover","div.wcff-layout-form-row > div",this,function(a){""!=a.data.draggedField&&$(this).addClass("hover")}),$(document).on("dragleave","div.wcff-layout-form-row > div",this,function(a){$(this).removeClass("hover")}),$(document).on("mousedown",this,function(a){if($(a.target).hasClass("handlebar")){a.data.isMouseDown=!0,a.data.targetDropZone=$(a.target).prev();var b=a.data.targetDropZone[0].getBoundingClientRect();a.data.targetDropZoneOffsetLeft=b.x}}),$(document).on("mousemove",this,function(a){if(a.data.isMouseDown){a.data.targetDropZone[0].style.flexGrow=0,a.data.targetDropZone[0].style.flexShrink=0;var b=a.clientX-a.data.targetDropZoneOffsetLeft;b-4>a.data.targetDropZone.parent().width()&&(b=a.data.targetDropZone.parent().width()),a.data.targetDropZone[0].style.flexBasis=Math.max(80,b-4)+"px";var d=0,e=a.data,f=a.data.targetDropZone.parent().width(),c=a.data.targetDropZone.parent().find("> div.handlebar").length,g=6*c;a.data.targetDropZone.parent().find("> div.dropped").each(function(a){d=(parseInt($(this).width())+parseInt(c>0?g/c:0))/f,e.layout.columns[$(this).attr("data-fkey")].width=100*d})}}),$(document).on("mouseup",this,function(a){a.data.isMouseDown&&(a.data.isMouseDown=!1,a.data.layoutFormRow=null,a.data.targetDropZone=null)}),$(document).on("click","div.dropped > a.delete-field",this,function(a){$(this).parent().prev().hasClass("handlebar")&&$(this).parent().prev().remove(),0==$(this).parent().index()&&$(this).parent().next().hasClass("handlebar")&&$(this).parent().next().remove();var b=$(this).parent().attr("data-fkey");$(this).parent().remove(),a.data.layout.columns[b]&&delete a.data.layout.columns[b];for(let c=0;c<a.data.layout.rows.length;c++)if(Array.isArray(a.data.layout.rows[c])){let e=a.data.layout.rows[c].indexOf(b);e> -1&&a.data.layout.rows[c].splice(e,1)}for(let d=0;d<a.data.layout.rows.length;d++)Array.isArray(a.data.layout.rows[d])&&0==a.data.layout.rows[d].length&&a.data.layout.rows.splice(d,1);$("div.wcff-layout-form-row").length>1&&$("div.wcff-layout-form-row").each(function(){$(this).siblings().length>0&&0==$(this).find("> div").length&&$(this).remove()}),a.data.fields[b]&&($("#wcff-layout-designer-field-list > h3").length>0&&$("#wcff-layout-designer-field-list > h3").remove(),$("#wcff-layout-designer-field-list").append($('<a href="#" draggable="true" data-fkey="'+b+'" data-type="'+a.data.fields[b].type+'" title="'+a.data.fields[b].label+'">'+a.data.fields[b].label+"</a>"))),a.preventDefault()}),$(document).on("click","div.wcff-meta-row > table.wcff_table",this,function(b){var e=b.data,c=!1,d=$(this),a=$("div.wcff-meta-row.active");$(this).parent().attr("data-key")==a.attr("data-key")&&(c=!0),a.length>0?a.find("div.wcff_fields_factory").toggle("slow","swing",function(){e.activeField=e.fetchFieldConfig(),e.dirtyFields[e.activeField.key]=e.activeField,a.find("input[name=wcff-field-type-meta-label-temp]").parent().html($("input[name=wcff-field-type-meta-label-temp]").val()),e.configWidgets[a.attr("data-key")]=a.find("div.wcff_fields_factory").clone(),a.find("div.wcff_fields_factory").remove(),a.removeClass("active"),c||e.handleFieldConfigClick(d)}):c||b.data.handleFieldConfigClick(d)}),$(document).on("click","a.wcff-field-update-btn",this,function(a){a.data.activeRow=$(this).closest("div.wcff-meta-row"),a.data.activeField=a.data.fetchFieldConfig(),a.data.dirtyFields[a.data.activeField.key]=a.data.activeField,a.data.prepareRequest("PUT","field",a.data.activeField,a.data.activeRow),a.data.mask.doMask(a.data.activeRow),a.data.dock(),a.preventDefault()}),$(document).on("click","label.wcff-switch, div.wcff_fields_factory_config_container",this,function(a){a.stopPropagation()}),$(document).on("change","label.wcff-switch input",this,function(a){a.stopPropagation();var b=!!$(this).is(":checked");a.data.mask.doMask($("#wcff-fields-set")),a.data.prepareRequest("PUT","toggle_field",{key:$(this).parent().attr("data-key"),status:b},null),a.data.dock()}),$(document).on("click","a.wcff-field-delete",this,function(a){!0===(uc=confirm("Are you sure, you want to delete this field.?"))&&(a.data.mask.doMask($(this).closest(".wcff_fields_factory_header")),a.data.prepareRequest("DELETE","field",{field_key:$(this).attr("data-key")},$(this)),a.data.dock()),a.preventDefault(),a.stopPropagation()}),$(document).on("click","div.wcff-factory-tab-header > a",this,function(c){c.preventDefault();var f=c.data.activeField.type,a=$(this).closest(".wcff_fields_factory_config_container");if(a.find("> div.wcff-factory-tab-header > a").removeClass(),$(this).addClass("selected"),a.find("> div.wcff-factory-tab-container > div").fadeOut(),a.find($(this).attr("href")).fadeIn(),"radio"==f||"select"==f)for(var d=a.find("select[class*=choice-expected-value]"),g="",b=0;b<d.length;b++){g=$(d[b]).val();var e=c.data.activeField.choices.replace(/;/g,"\n");if(e=e.trim().split("\n")){for(var i="",j=[],h=0;h<e.length;h++)i+='<option value="'+(j=e[h].split("|"))[0]+'">'+j[1]+"</option>";$(d[b]).html(i)}""!=g&&$(d[b]).val(g)}else"colorpicker"==f&&0!=a.find("[name=wcff-field-type-meta-palettes]").length&&(c.data.activeField.choices=a.find("[name=wcff-field-type-meta-palettes]").val().trim().replace("\n",","))}),$(document).on("click","a.condition-add-rule",this,function(a){a.data.addCondition($(this)),a.preventDefault()}),$(document).on("click","a.condition-remove-rule",this,function(a){a.data.removeRule($(this)),a.preventDefault()}),$(document).on("click","a.condition-add-group",this,function(a){a.data.addConditionGroup($(this)),a.preventDefault()}),$(document).on("click","a.location-add-rule",this,function(a){a.data.addLocation($(this)),a.preventDefault()}),$(document).on("click","a.location-remove-rule",this,function(a){a.data.removeRule($(this)),a.preventDefault()}),$(document).on("click","a.location-add-group",this,function(a){a.data.addLocationGroup($(this)),a.preventDefault()}),$(document).on("click",".wcff-add-price-rule-btn",this,function(a){a.data.addFieldLevelRule($(this),"pricing")}),$(document).on("click",".wcff-add-fee-rule-btn",this,function(a){a.data.addFieldLevelRule($(this),"fee")}),$(document).on("click",".wcff-add-field-rule-btn",this,function(a){a.data.addFieldLevelRule($(this),"field")}),$(document).on("click",".wcff-add-color-image-rule-btn",this,function(a){a.data.addFieldLevelRule($(this),"color-image")}),$(document).on("change",".wcff_condition_param",this,function(a){a.data.prepareRequest("GET",$(this).val(),{},$(this)),a.data.dock()}),$(document).on("change",".variation_product_list",this,function(a){a.data.prepareRequest("GET","product_variation",{product_id:$(this).val()},$(this)),a.data.dock()}),$(document).on("change",".wcff_location_param",this,function(a){a.data.prepareRequest("GET",$(this).val(),{},$(this)),a.data.dock()}),$(document).on("click",".wcff-rule-toggle > a",function(b){if($(this).parent().find("a").removeClass("selected"),$(this).addClass("selected"),$(this).parent().is(".amount-mode")){var a="cost"===$(this).attr("data-tprice")?"Amount":"Percentage";$(this).parent().is(".pricing-amount-mode")?("Percentage"===a?$(this).closest("tr").find("a.price-rule-change").remove():$(this).closest("tr").find("div.calculation-mode").append($('<a href="#" data-ptype="change" title="Replace the original product price with this amount" class="price-rule-change">Replace</a>')),$(this).closest("tr").find(".wcff-pricing-rules-amount").prev().html(a)):$(this).parent().is(".fee-amount-mode")&&$(this).closest("tr").find(".wcff-fee-rules-amount").prev().html(a)}$(this).parent().is(".wcff-color-image-toggle")&&($(this).parent().parent().parent().find("div.wcff-image-selector-container").toggle(),$(this).parent().parent().parent().find("div.wcff-url-selector-container").toggle()),b.preventDefault()}),0!=$("#wcff-fields-set").length&&$("#wcff-fields-set").sortable({update:function(){var a="wcccf"==wcff_var.post_type?1:0;$('.wcff-meta-row:not([data-unremovable="true"][data-is_enable="false"])').each(function(){!$(this).is("#wcff-add-field-placeholder")&&($(this).find("input.wcff-field-order-index").val(a),$(this).find("span.wcff-field-order-number").text("wcccf"==wcff_var.post_type?a:a+1),a++)})},cancel:".active, #wcff-add-field-placeholder, .wcff-field-config-drawer-opened, .wcff-field-delete, .wcff-meta-option"}),$(document).on("click","td.field-label input",function(a){a.stopPropagation()}),$(document).on("keyup","textarea.wcff-choices-textarea",this,function(a){a.data.handleDefault($(this))}),$(document).on("blur","td.field-label input, div.wcff-field-types-meta input, div.wcff-field-types-meta textarea",this,function(a){$(this).hasClass("wcff-option-label-text")||$(this).hasClass("wcff-option-value-text")||a.data.updateField()}),$(document).on("change",".wcff-option-value-text, .wcff-option-label-text",this,function(a){""==$(this).val()?$(this).addClass("invalid"):$(this).removeClass("invalid")}),$(document).on("click","button.wcff-add-opt-btn",this,function(a){a.data.addOption($(this)),a.preventDefault(),a.stopPropagation()}),$(document).on("click","div.wcff-factory-tab-left-panel li",this,function(a){$(this).parent().parent().next().find(">div").hide(),$(this).parent().find("> li").removeClass(),$(this).addClass("selected"),$(this).parent().parent().next().find(">div:nth-child("+($(this).index()+1)+")").show()}),$(document).on("click","a.wcff-date-disable-radio-clear",this,function(a){$(this).parent().prev().find("input").prop("checked",!1),a.preventDefault()}),$(document).on("change","input[name=wcff-field-type-meta-img_is_prev]",this,function(a){"yes"===$(this).val()?$("div[data-param=img_is_prev_width]").fadeIn():$("div[data-param=img_is_prev_width]").fadeOut(),a.preventDefault()}),$(document).on("keyup","textarea.wcff-field-type-meta-choices",this,function(a){a.data.handleDefault($(this))}),$(document).on("change",".wcff-color-image-select-container input[type=radio]",function(){$(this).is(":checked")&&($(this).closest(".wcff-color-image-select-container").find(".color-active").removeClass("color-active"),$(this).closest(".wcff-color-image-select-container").find("input").prop("checked",!1),$(this).prop("checked",!0),$(this).parent().addClass("color-active"))}),$(document).on("click",".wcff-upload-custom-img",this,function(a){a.preventDefault();var b=$(this).parent().parent(),c=b.find(".wcff-prev-image"),d=b.find(".wcff-image-url-holder"),e=b.find(".wcff-upload-custom-img"),f=b.find(".wcff-delete-custom-img");if(a.data.mediaFrame){a.data.mediaFrame.open();return}a.data.mediaFrame=wp.media({title:"Select or Upload Media Of Your Chosen",button:{text:"Use this Image"},multiple:!1}),a.data.mediaFrame.on("select",function(){var b=a.data.mediaFrame.state().get("selection").first().toJSON();c.replaceWith('<img class="wcff-prev-image" src="'+b.url+'" alt="" style="width:80px;"/>'),d.val(b.id),e.addClass("hidden"),f.removeClass("hidden")}),a.data.mediaFrame.open()}),$(document).on("click",".wcff-delete-custom-img",this,function(b){b.preventDefault();var a=$(this).parent().parent(),c=a.find(".wcff-prev-image"),d=a.find(".wcff-image-url-holder"),e=a.find(".wcff-upload-custom-img");c.replaceWith('<img class="wcff-prev-image" src="'+wcff_var.plugin_dir+'/assets/img/placeholder-image.jpg" alt="" style="width:80px;"/>'),$(this).addClass("hidden"),e.removeClass("hidden"),d.val("")}),$(document).on("click","div.wcff-variation-config-tab-header > a",this,function(a){$("div.wcff-variation-config-tab-content > div").hide(),$(this).siblings().removeClass("selected"),$($(this).attr("href")).show(),$(this).addClass("selected"),$("a.wcff-variation-config-action-btn").hide(),"#wcff-variation-config-fields"==$(this).attr("href")?$("a.wcff-variation-config-action-btn.new").show():($("a.wcff-variation-config-action-btn.cancel").show(),$("a.wcff-variation-config-action-btn.save").show(),a.data.mapping_grid=new wccvf_grid($,$("div.wcff-variation-config-mapping-content")),a.data.mapping_grid.init()),a.preventDefault()}),$(document).on("click","a.wcff-variation-config-action-btn",this,function(a){$(this).hasClass("new")||a.preventDefault()}),$(document).on("click",".wcff-variation-config-search-field",this,function(a){if(a.stopPropagation(),!a.data.ajaxFlaQ)return;0===$("div.variation-config-ghost-back").length&&$("body").prepend($('<div class="variation-config-ghost-back"></div>'));let d={},b=$("#wcff-variation-config-product-select");if("variations"==$(this).attr("data-type")&&b.find("> li").length>1){if(b.is(":visible")||b.fadeIn("normal"),0==b.find("a.selected").length){alert("Please choose a Product First"),$("#wcff-variation-config-product-search").focus();return}}else if("variations"==$(this).attr("data-type")&&0==b.find("> li").length){alert("Please choose a Product First"),$("#wcff-variation-config-product-search").trigger("click"),$("#wcff-variation-config-product-search").focus();return}if($(this).parent().find(">img").show(),"variations"==$(this).attr("data-type"))a.data.prepareRequest("GET","search",{search:$(this).val(),post_type:$(this).attr("data-type"),parent:b.find("a.selected").attr("data-id"),context:"variable_mapping"},$(this));else{let c=$(this).attr("data-type");"wccvf-specific"==$(this).attr("data-type")?(c="wccvf",a.data.currentProduct=$(this).parent().attr("data-pid"),a.data.currentVariation=$(this).parent().attr("data-vid"),a.data.currentWccvfSearchField=$(this),a.data.currentWccvfSearchField.parent().css("z-index","99999"),a.data.mapping_grid.currentVariant=$(this).parent().attr("data-vid"),a.data.mapping_grid.targetRow=$(this).closest("div.wccvf-data-grid-row").prev()):("wccvf-all"==$(this).attr("data-type")&&(c="wccvf"),a.data.currentWccvfSearchField&&a.data.currentWccvfSearchField.parent().css("z-index","9"),a.data.currentProduct=null,a.data.currentVariation=null,a.data.currentWccvfSearchField=null),d={search:$(this).val(),post_type:c,context:"variable_mapping"},"product_variation"==c&&(d.page=1),a.data.prepareRequest("GET","search",d,$(this))}a.data.dock()}),$(document).on("keydown",".wcff-variation-config-search-field",this,function(a){var d=null,e=a.data,c={};if(a.data.searchTimer&&clearTimeout(a.data.searchTimer),27!=a.keyCode){var b=$("#wcff-variation-config-product-select");if("variations"==$(this).attr("data-type")&&b.find("> li").length>1){if(b.is(":visible")||b.fadeIn("normal"),0==b.find("a.selected").length){alert("Please choose a Product First"),$("#wcff-variation-config-product-search").focus();return}}else if("variations"==$(this).attr("data-type")&&0==b.find("> li").length){alert("Please choose a Product First"),$("#wcff-variation-config-product-search").trigger("click"),$("#wcff-variation-config-product-search").focus();return}$(this).parent().find(">img").show(),"variations"==$(this).attr("data-type")?d=a.data.prepareSearchRequest("GET","search",{search:$(this).val(),post_type:$(this).attr("data-type"),parent:b.find("a.selected").attr("data-id"),context:"variable_mapping"},$(this)):(c={search:$(this).val(),post_type:$(this).attr("data-type"),context:"variable_mapping"},"product_variation"==$(this).attr("data-type")&&(c.page=1),d=a.data.prepareSearchRequest("GET","search",c,$(this))),a.data.searchTimer=setTimeout(function(){e.searchDock(d)},200)}}),$(document).on("click","ul.wcff-variation-config-popup a",this,function(a){if(a.preventDefault(),a.data.ajaxFlaQ){if($(this).closest("ul").hasClass("individual")){let b={};b[$(this).attr("data-id")]=[[{context:"variations",logic:"==",endpoint:a.data.currentVariation}]],a.data.mask.doMask(a.data.currentWccvfSearchField.next()),a.data.prepareRequest("POST","variation_fields_map",{rules:b,product:$(this).closest("div.wcff-variation-mapper-for-variation").attr("data-pid")},null),a.data.dock()}else"product"==$(this).closest("ul").attr("data-type")?($(this).closest("ul").find("a").removeClass("selected"),$(this).addClass("selected"),$(this).closest("ul").next().show(),a.data.prepareRequest("GET","search",{search:$("#wcff-variation-config-variation-search").val(),post_type:"variations",parent:$(this).attr("data-id"),context:"variable_mapping"},$(this)),a.data.dock()):$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")}}),$(document).on("click","#wcff-variation-config-map-btn",this,function(a){a.data.handleVariationFieldsMap()}),$(document).on("click","a.wcff-field-clone",this,function(a){a.data.prepareRequest("GET","wcff_field_clone",{fkey:$(this).attr("data-key")},$(this)),a.data.dock(),a.preventDefault(),a.stopPropagation()}),$(document).on("change","select.wcff-field-input-condition-value",this,function(a){"not-null"==$(this).val()?($(this).closest("div.rule-section").next().fadeOut("normal"),$(this).closest("div.rule-section").next().find("input.wcff-field-input-expected-value").val("")):$(this).closest("div.rule-section").next().fadeIn("normal")}),$(document).on("change","input.wcff-group-authorized-only-radio",this,function(a){"yes"===$(this).val()?$("#wcff-target-roles-container").fadeIn("normal"):$("#wcff-target-roles-container").fadeOut("normal")}),$(document).on("change","input.wcff-field-type-meta-show_on_product_page",this,function(b){var a="table-row";"no"===$(this).val()&&(a="none"),$("div.wcff-field-types-meta").each(function(){var b=!1;("visibility"===$(this).attr("data-param")||"login_user_field"===$(this).attr("data-param")||"cart_editable"===$(this).attr("data-param")||"cloneable"===$(this).attr("data-param")||"show_as_read_only"===$(this).attr("data-param")||"hide_when_no_value"===$(this).attr("data-param")||"show_with_value"===$(this).attr("data-param")||"showin_value"===$(this).attr("data-param"))&&(b=!0),b&&("none"==a?$(this).closest("tr").fadeOut():$(this).closest("tr").fadeIn())})}),$(document).on("change",".wcff-field-type-meta-login_user_field",this,function(b){var a="no"===$(this).val()?"none":"table-row";$(this).closest(".wcff-meta-row").find("div[data-param=show_for_roles]").closest("tr").css("display",a)}),$(document).on("click","a.wcff-date-disable-radio-clear",this,function(a){$(".wcff-field-type-meta-weekend_weekdays").prop("checked",!1),a.preventDefault()}),$(document).on("click","div.wcff-factory-lister-tab-header a",this,function(a){a.preventDefault(),$(this).addClass("selected").siblings().removeClass(),$(this).parent().next().find("> div").hide(),$($(this).attr("href")).show(),"#wcff-fields-layout-container"==$(this).attr("href")&&(a.data.prepareRequest("GET","wcff_field_list",{},$("#wcff-fields-layout-container")),a.data.dock())}),$(document).on("change","input[name=wcff_use_custom_layout]",this,function(a){$(this).is(":checked")?($("#wcff-layout-designer-pad").css("opacity","1").css("pointer-events","auto"),$("#wcff-layout-designer-field-list").css("opacity","1").css("pointer-events","auto")):($("#wcff-layout-designer-pad").css("opacity",".5").css("pointer-events","none"),$("#wcff-layout-designer-field-list").css("opacity",".5").css("pointer-events","none"))}),$(document).on("change","input[name=options-render_method], input[name=wcff-default-choice]",this,function(a){a.data.prepareRadioOptionPreviewView()}),$(document).on("click","a.wcff-button-remove",function(a){(1==$(this).parent().parent().find("div.wcff-pricing-row").length||1==$(this).parent().parent().find("div.wcff-fee-row").length)&&$(this).parent().parent().find("div.wcff-rule-container-is-empty").show(),$(this).parent().remove(),a.preventDefault()}),$(document).on("change","input[name=options-timepicker]",this,function(b){var a="no"===$(this).val()?"none":"table-row";$("div[data-param=min_max_hours_minutes]").closest("tr").css("display",a)}),$(document).on("click","a.wccvf-grid-map-product-link",this,function(a){a.data.mapping_grid.renderVariations($(this),!1),a.preventDefault()}),$(document).on("click","a.wccvf-grid-map-variation-link",this,function(a){a.data.currentProduct=$(this).attr("data-pid"),a.data.currentVariation=$(this).attr("data-vid"),a.data.mapping_grid.renderMappedGroups($(this)),a.preventDefault()}),$(document).on("click","a.wccvf-grid-group-remove-btn",this,function(a){a.preventDefault(),a.data.mapping_grid.currentVariant=$(this).attr("data-vid"),a.data.mapping_grid.targetRow=$(this).closest("div.wccvf-data-grid-row").prev(),a.data.mask.doMask(a.data.mapping_grid.gridTable),a.data.prepareRequest("DELETE","mapping",{pid:$(this).attr("data-gid"),vid:$(this).attr("data-vid")},$(this)),a.data.dock()}),$(document).on("click","a.wccvf-grid-page-btn",this,function(a){a.preventDefault(),$(this).closest("ul").find("a").removeClass("current"),a.data.mapping_grid.handlePageClick($(this).attr("data-page"))}),$(document).on("keyup","#wccvf-grid-search-map-txt",this,function(a){a.data.mapping_grid.handleSearch($(this))}),$(document).on("mousedown","select.wcff_condition_value, select.variation_product_list",this,function(a){if($(this).hasClass("variation-select"))return!0;$("div.wcff-target-selector").hide();let b=$(this).parent().prev().prev().find("select").val();"product_type"!=b&&(a.preventDefault(),this.blur(),window.focus(),a.data.currentProductSearchField=$(this),0==$(this).parent().find("div.wcff-target-selector").length?a.data.prepareTargetSelectorWidget($(this),b):$(this).parent().find("div.wcff-target-selector").show())}),$(document).on("click","div.wcff-target-select-result > a",this,function(a){a.preventDefault()}),$(document).on("click","li.variation-popup-pagination > button",this,function(a){if(!a.data.ajaxFlaQ)return;let b=parseInt($(this).parent().attr("data-page")),c=$(this).parent().parent().prev().val();$(this).hasClass("prev")?b--:b++,a.data.mask.doMask($(this).closest("ul.wcff-variation-config-popup")),a.data.prepareRequest("GET","search",{search:c,post_type:"product_variation",parent:0,page:b,context:"variation_mapping"},$(this).closest("ul.wcff-variation-config-popup")),a.data.dock(),a.preventDefault()}),$(document).on("click","div.wcff-target-select-pagination > button",this,function(a){if(!a.data.ajaxFlaQ)return;let c=parseInt($(this).parent().attr("data-page")),e=$(this).closest("div.wcff-target-selector").find("input.wcff-target-select-search").val();$(this).hasClass("prev")?c--:c++,a.data.mask.doMask($(this).closest("div.wcff-target-selector"));let b=$(this).closest("div.wcff-target-selector").attr("data-type"),d={search:e,post_type:b,parent:0,page:c,context:"product_mapping"};("product_cat"==b||"product_tag"==b)&&(d.taxonomy=b),a.data.prepareRequest("GET","search",d,$(this).closest("div.wcff-target-selector")),a.data.dock(),a.preventDefault()}),$(document).on("keyup",".wcff-target-select-search",this,function(a){var d=null,e=a.data,b="",c={};if(a.data.searchTimer&&clearTimeout(a.data.searchTimer),27==a.keyCode){$(this).closest("div.wcff-target-selector").hide();return}a.data.mask.doMask($(this).next()),a.data.target=$(this).closest("div.wcff-target-selector"),c={search:$(this).val(),post_type:"product",page:1,context:"product_mapping"},b=$(this).closest("div.wcff-target-selector").attr("data-type"),c.post_type=b,("product_cat"==b||"product_tag"==b)&&(c.taxonomy=b),d=a.data.prepareSearchRequest("GET","search",c),a.data.searchTimer=setTimeout(function(){e.searchDock(d)},250)}),$(document).on("click","div.wcff-target-select-result > a",this,function(a){a.data.currentProductSearchField.html('<option value="-1">All Products</option><option value="'+$(this).attr("data-id")+'" selected>'+$(this).text()+"</option>"),a.data.currentProductSearchField.trigger("change"),$(this).closest("div.wcff-target-selector").hide(),a.preventDefault()}),$(document).on("click","div.wcff-meta-row.active label.wcff-field-name",this,function(a){$(this).hide(),$(this).after($('<input type="text" class="wcff-field-key-edit-txt" value="'+$(this).text()+'"/>')),a.stopPropagation()}),$(document).on("keydown","input.wcff-field-key-edit-txt",this,function(a){if(13==a.keyCode){let b=a.data.activeField.key;a.data.activeRow=$(this).closest("div.wcff-meta-row"),a.data.activeField=a.data.fetchFieldConfig(),a.data.activeField.key=$(this).val(),a.data.dirtyFields[a.data.activeField.key]=JSON.parse(JSON.stringify(a.data.activeField)),delete a.data.dirtyFields[b],$(this).prev().show().html($(this).val()),$(this).remove(),a.data.activeRow.attr("data-key",a.data.activeField.key),a.data.activeRow.find("td.field-actions").find("a").attr("data-key",a.data.activeField.key),a.data.activeRow.find("td.field-actions").find("label.wcff-switch").attr("data-key",a.data.activeField.key),a.data.activeField.to_be_removed=b,a.data.prepareRequest("PUT","field",a.data.activeField,a.data.activeRow),a.data.mask.doMask(a.data.activeRow),a.data.dock()}a.stopPropagation()}),$(document).on("click","input.wcff-upload-image-radio-btn",this,function(a){var b=a.data,c=$(this),d=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){var a=d.state().get("selection").first().toJSON();(Array.isArray(b.activeField.images)||!b.activeField.images)&&(b.activeField.images={}),b.activeField.images[c.attr("data-option")]={aid:a.id,url:a.url},b.prepareRadioOptionPreviewView()}).open()}),$(document).on("click","div.wcff-image-button-preview-wrapper > a",this,function(a){a.preventDefault();var b=$(this).parent().attr("data-option");a.data.activeField.images&&a.data.activeField.images[b]&&(delete a.data.activeField.images[b],a.data.prepareRadioOptionPreviewView())}),$(document).on("click","button.wcff-factory-multilingual-label-btn, button.wcff-factory-multilingual-btn",function(a){$(this).hasClass("wcff-factory-multilingual-btn")?$(this).nextAll("div.wcff-locale-list-wrapper").first().toggle("normal"):$(this).next().toggle("normal"),a.preventDefault(),a.stopPropagation()}),$(document).on("change","#wcff-option-render-label",this,function(a){$(this).is(":checked")?$("#wcff-preview-label-pos-select").show():$("#wcff-preview-label-pos-select").hide(),a.data.prepareRadioOptionPreviewView()}),$(document).on("change","#wcff-render-option-label-position",this,function(a){a.data.prepareRadioOptionPreviewView()}),$(document).on("change","textarea[name=wcff-field-type-meta-choices]",this,function(a){if(27==a.keyCode)return}),$(document).on("change","select.wcff_location_product_data_value",this,function(a){"wccaf_custom_product_data_tab"==$(this).val()?$("#wccaf_custom_product_data_tab_title_container").show():$("#wccaf_custom_product_data_tab_title_container").hide()}),$(document).on("submit","form#post",this,function(a){return a.data.onPostSubmit($(this))})},this.prepareTargetSelectorWidget=function(e,b){let c="",a='<div class="wcff-target-selector '+b+'" data-type="'+b+'">';"product"==b?c="product":"product_cat"==b?c="category":"product_tag"==b?c="tag":"product_variation"==b&&(c="variable product"),a+='<input type="text" placeholder="Search '+c+' ..." class="wcff-target-select-search '+b+'"/>',a+='<div class="wcff-target-select-result">',a+="</div>",a+='<div class="wcff-target-select-pagination">',a+='<button class="prev"><img src="'+wcff_var.plugin_dir+'/assets/img/prev.png" /></button>',a+='<button class="next"><img src="'+wcff_var.plugin_dir+'/assets/img/next.png" /></button>',a+="</div>",a+="</div>",a=$(a),e.parent().append(a),setTimeout(()=>{this.mask.doMask(a),a.find("input.wcff-target-select-search").focus()},100);let d={search:"",post_type:b,parent:0,page:1,context:"product_mapping"};("product_cat"==b||"product_tag"==b)&&(d.taxonomy=b),this.prepareRequest("GET","search",d,a),this.dock()},this.prepareRadioOptionPreviewView=function(){$(".wcff-preview-choice-wrapper").closest("tr").show(),$("#wcff-option-text-config-container").hide(),$("#wcff-option-color-config-container").hide(),$("#wcff-option-image-config-container").hide(),$("div.wcff-preview-label-opt-container").hide();var b=0,a="",c="",d=$("textarea.wcff-field-type-meta-choices").val(),h=$("input[name=options-render_method]:checked").val(),e=$(".wcff-preview-choice-wrapper").closest(".wcff-meta-row").find(".wcff-default-option-holder").find("input[type=radio]:checked").val(),f=$("#wcff-option-render-label").is(":checked"),g=$("#wcff-render-option-label-position").val();if(d=(d=d.trim()).split("\n"),"text"==h){for($("#wcff-option-text-config-container").show(),a+='<ul class="wcff-color-preview-option-list">',b=0;b<d.length;b++)c="",2==(keyval=d[b].split("|")).length&&""!=keyval[0].trim()&&""!=keyval[1].trim()&&(e&&e.trim()===keyval[0].trim()&&(c='class="selected"'),a+="<li "+c+">",a+='<div class="wcff-text-button-preview-wrapper">'+keyval[1].trim()+"</div>",a+="</li>");a+="</ul>",$("#wcff-option-text-config-container").html(a)}else if("color"==h){for($("#wcff-option-color-config-container").show(),$("div.wcff-preview-label-opt-container").show(),a+='<ul class="wcff-color-preview-option-list">',b=0;b<d.length;b++)c="",2==(keyval=d[b].split("|")).length&&""!=keyval[0].trim()&&""!=keyval[1].trim()&&(e&&e.trim()===keyval[0].trim()&&(c='class="selected"'),a+="<li "+c+">",f&&"top"==g&&(a+="<label>"+keyval[1]+"</label>"),a+='<div class="wcff-color-button-preview-wrapper"><span style="background: '+keyval[0].trim()+'"></span></div>',f&&"bottom"==g&&(a+="<label>"+keyval[1]+"</label>"),a+="</li>");a+="</ul>",$("#wcff-option-color-config-container").html(a)}else if("image"==h){for($("#wcff-option-image-config-container").show(),$("div.wcff-preview-label-opt-container").show(),a+='<ul class="wcff-color-preview-option-list">',b=0;b<d.length;b++)c="",2==(keyval=d[b].split("|")).length&&""!=keyval[0].trim()&&""!=keyval[1].trim()&&(e&&e.trim()===keyval[0].trim()&&(c='class="selected"'),a+="<li "+c+">",f&&"top"==g&&(a+="<label>"+keyval[1]+"</label>"),this.activeField.images&&this.activeField.images[keyval[0].trim()]?(a+='<div class="wcff-image-button-preview-wrapper" data-option="'+keyval[0].trim()+'">',a+='<a href="#" class="">x</a>',a+='<img src="'+this.activeField.images[keyval[0].trim()].url+'" />',a+="</div>"):(a+='<div class="wcff-image-button-preview-wrapper">',a+='<input type="button" class="wcff-upload-image-radio-btn" data-option="'+keyval[0].trim()+'" value="Set\nImage"/>',a+="</div>"),f&&"bottom"==g&&(a+="<label>"+keyval[1]+"</label>"),a+="</li>");a+="</ul>",$("#wcff-option-image-config-container").html(a)}else $(".wcff-preview-choice-wrapper").closest("tr").hide()},this.handleFieldConfigClick=function(a){this.activeRow=a.closest("div.wcff-meta-row"),this.activeRow.addClass("opened active"),this.dirtyFields[this.activeRow.attr("data-key")]?this.configWidgets[this.activeRow.attr("data-key")]?(this.activeRow.find(".wcff-field-label").html('<input type="text" name="wcff-field-type-meta-label-temp" value="'+this.activeRow.find(".wcff-field-label").text()+'" autocomplete="off">'),this.activeRow.append(this.configWidgets[this.activeRow.attr("data-key")]),delete this.configWidgets[this.activeRow.attr("data-key")],this.activeField=this.dirtyFields[this.activeRow.attr("data-key")],this.activeRow.find("div.wcff_fields_factory").toggle("slow","swing",function(){})):(this.activeField=this.fetchFieldConfig(),this.dirtyFields[this.activeField.key]=this.activeField,this.activeRow.removeClass("active"),this.activeRow.find("input[name=wcff-field-type-meta-label-temp]").parent().html($("input[name=wcff-field-type-meta-label-temp]").val()),this.configWidgets[e.data.activeRow.attr("data-key")]=this.activeRow.find("div.wcff_fields_factory").clone(),this.activeRow.find("div.wcff_fields_factory").remove(),this.activeRow=null,this.activeField=null):(this.mask.doMask($("#wcff-fields-set")),this.activeRow.find(".wcff-field-label").html('<input type="text" name="wcff-field-type-meta-label-temp" value="'+this.activeRow.find(".wcff-field-label").text()+'" autocomplete="off">'),this.prepareRequest("GET","field",{key:this.activeRow.attr("data-key"),type:this.activeRow.attr("data-type")},this.activeRow),this.dock())},this.addOption=function(b){var a=b.prevAll("input.wcff-option-value-text").first(),c=b.prevAll("input.wcff-option-label-text").first();if(""==a.val()?(a.addClass("invalid"),a.focus()):a.removeClass("invalid"),""==c.val()?(c.addClass("invalid"),c.focus()):c.removeClass("invalid"),""!=a.val()&&""!=c.val()){var d=b.closest(".wcff-meta-row").find("textarea[name="+b.attr("data-target")+"]");""!=d.val()&&"\n"!=d.val().slice(-1)&&d.val(d.val()+"\n"),d.val(d.val()+(a.val()+"|"+c.val())+"\n"),0==b.closest(".wcff-locale-block").length&&(this.activeField.choices=d.val()),a.val(""),c.val(""),a.focus(),this.handleDefault(b.closest(".wcff-meta-row").find("textarea[name="+b.attr("data-target")+"]"))}},this.handleTargetProductSearch=function(f,a){var d="",b=a.payload.records,e=Math.ceil(a.payload.total/a.payload.records_per_page);if(popup=this.target.find("div.wcff-target-select-result"),pagination=this.target.find(".wcff-target-select-pagination"),b||(b=[]),b.length>0)for(let c=0;c<b.length;c++)d+='<a href="#" data-id="'+b[c].id+'">'+b[c].title+"</a>";else d="<p>No record(s) found.!</p>";popup.html(d),pagination.attr("data-page",a.payload.page),e>1?(pagination.removeClass("disable"),pagination.find("> button").removeClass("disable"),1==a.payload.page?pagination.find("> button:first-child").addClass("disable"):a.payload.page==e&&pagination.find("> button:last-child").addClass("disable")):pagination.addClass("disable"),this.mask.doUnMask()},this.handleSearch=function(b,d){if(b.payload&&b.payload.post_type){var a=0,h=0,g="",i=null,f=null,c=null,e=[];if(b.payload.parent?(f=$("#wcff-variation-config-variation-search"),c=$("#wcff-variation-config-variation-select")):"product_variation"===b.payload.post_type?(f=$("#wcff-variation-config-product-search"),c=$("#wcff-variation-config-product-select")):"variations"===b.payload.post_type?(f=$("#wcff-variation-config-variation-search"),c=$("#wcff-variation-config-variation-select")):"wccvf"!==b.payload.post_type||this.currentWccvfSearchField?"wccvf"===b.payload.post_type&&this.currentWccvfSearchField&&(f=this.currentWccvfSearchField,c=this.currentWccvfSearchField.next()):(f=$("#wcff-variation-config-group-search"),c=$("#wcff-variation-config-group-select")),c){if(c.show(),c.width(c.prev().outerWidth()-2),d.payload.records.splice(0,1),e=d.payload.records,this.currentWccvfSearchField){if(c.next().hide(),e=[],this.currentProduct&&this.currentVariation)for(a=0,groups=this.mapping_grid.records[this.currentProduct].variations[this.currentVariation].groups;a<d.payload.length;a++){for(h=0,i=!0;h<groups.length;h++)if(d.payload[a].id==groups[h].gid){i=!1;break}i&&e.push(d.payload[a])}}else c.closest("table").find("img.progress-img").hide();if("variations"===b.payload.post_type&&this.mapping_grid.records[this.request.payload.parent]){let j=[],l=this.mapping_grid.records[this.request.payload.parent].variations;for(a=0;a<e.length;a++)l[e[a].id]&&j.push(a);for(a=j.length-1;a>=0;a--)e.splice(j[a],1)}if(e.length>0)for(a=0;a<e.length;a++)g+='<li><a href="" data-id="'+e[a].id+'">'+e[a].title+"</a></li>";else g+="<li><p>Nothing left for mapping.!</p></li>";if("product_variation"===b.payload.post_type){let k=Math.ceil(d.payload.total/d.payload.records_per_page);k>1&&(g+='<li class="variation-popup-pagination" data-page="'+d.payload.page+'">',g+='<button class="prev '+(1==d.payload.page?"disable":"")+'"><img src="'+wcff_var.plugin_dir+'/assets/img/prev.png" /></button>',g+='<button class="next '+(d.payload.page==k?"disable":"")+'"><img src="'+wcff_var.plugin_dir+'/assets/img/next.png" /></button>')}c.html(g)}f&&""==f.val()&&""!=b.payload.search&&(b.payload.search="",this.searchDock(b))}},this.reloadVariationLevelConfigPopup=function(){var a=0,c="",d=!0,e=[],f=null,b=[];if(this.mask.doMask(this.currentWccvfSearchField.next()),this.mapping_grid.records=this.response.payload,this.mapping_grid.products=Object.keys(this.mapping_grid.records),this.mapping_grid.totalPages=Math.ceil(this.mapping_grid.products.length/this.mapping_grid.recordsPerPage),this.currentProduct&&this.currentVariation){for(a=0,f=this.currentWccvfSearchField.next(),e=this.mapping_grid.records[this.currentProduct].variations[this.currentVariation].groups;a<this.wccvfPosts.length;a++){for(j=0,d=!0;j<e.length;j++)if(this.wccvfPosts[a].id==e[j].gid){d=!1;break}d&&b.push(this.wccvfPosts[a])}if(b.length>0)for(a=0;a<b.length;a++)c+='<li><a href="" data-id="'+b[a].id+'">'+b[a].title+"</a></li>";else c+="<li><p>Nothing left for mapping.!</p></li>";f.html(c)}},this.handleVariationFieldsMap=function(){var b,d,a=0,g={},i={},j=[],k={},l=[],c=[],h=[],e=$("#wcff-variation-config-group-select a.selected"),f=$("#wcff-variation-config-variation-select a.selected");if(0==e.length){alert("You have to select one or more Variations to Map");return}if(0==f.length){alert("You have to select one or more Fields Group to Map");return}for(f.each(function(){l.push($(this).attr("data-id")),c.push({vid:$(this).attr("data-id"),vtitle:$(this).text()})}),e.each(function(){for(a=0,j=[];a<l.length;a++)i=[],(k={}).context="product_variation",k.logic="==",k.endpoint=l[a],i.push(k),j.push(i);g[$(this).attr("data-id")]=j,h.push({gid:$(this).attr("data-id"),gtitle:$(this).text()})}),b=$("#wcff-variation-config-product-select a.selected").attr("data-id"),d=$("#wcff-variation-config-product-select a.selected").text(),this.mapping_grid.records[b]||(this.mapping_grid.records[b]={product_title:d,variations:{}}),a=0;a<c.length;a++)this.mapping_grid.records[b].variations[c[a].vid]={groups:h,variation_title:c[a].vtitle};this.currentVariation=null,this.currentWccvfSearchField=null,this.prepareRequest("POST","variation_fields_map",{rules:g,product:$("#wcff-variation-config-product-select a.selected").attr("data-id")},null),this.dock()},this.handleDefault=function(g){var b="",a=[],e=null,f=g.val(),h=g.closest(".wcff-meta-row"),d=h.find(".wcff-default-option-holder"),i=g.attr("data-locale"),j=h.attr("data-type");if(void 0!==i&& !1!==i&&(d=h.find(".wcff-default-option-holder-"+i)),f=(f=f.trim()).split("\n"),"checkbox"===j){e=d.find("input[type=checkbox]:checked").map(function(){return this.value}).get(),d.html(""),b+="<ul>";for(var c=0;c<f.length;c++)2==(a=f[c].split("|")).length&&""!=a[0].trim()&&""!=a[1].trim()&&(e&&e.indexOf(a[0])> -1?b+='<li><input type="checkbox" value="'+a[0]+'" checked /> '+a[1]+"</li>":b+='<li><input type="checkbox" value="'+a[0]+'" /> '+a[1]+"</li>");b+="</ul>",d.html(b)}else if("radio"===j){e=d.find("input[type=radio]:checked").val(),d.html(""),b+="<ul>";for(var c=0;c<f.length;c++)2==(a=f[c].split("|")).length&&""!=a[0].trim()&&""!=a[1].trim()&&(e&&e===a[0]?b+='<li><input name="wcff-default-choice" type="radio" value="'+a[0]+'" checked /> '+a[1]+"</li>":b+='<li><input name="wcff-default-choice" type="radio" value="'+a[0]+'" /> '+a[1]+"</li>");b+="</ul>",d.html(b),this.prepareRadioOptionPreviewView()}else{e=d.find("select").val(),d.html(""),b+="<select>",b+='<option value="">-- Choose the default Option --</option>';for(var c=0;c<f.length;c++)2==(a=f[c].split("|")).length&&""!=a[0].trim()&&""!=a[1].trim()&&(e&&e===a[0]?b+='<option value="'+a[0]+'" selected >'+a[1]+"</option>":b+='<option value="'+a[0]+'">'+a[1]+"</option>");b+="</select>",d.html(b)}},this.addCondition=function(b){var a=$("<tr></tr>");a.html(b.parent().parent().parent().find("tr").last().html()),1==b.parent().parent().parent().children().length&&a.find("td.remove").html('<a href="#" class="condition-remove-rule wcff-button-remove"></a>'),b.parent().parent().parent().append(a),a.find("select.wcff_condition_param").trigger("change")},this.addLocation=function(b){var a=$("<tr></tr>");a.html(b.parent().parent().parent().find("tr").last().html()),1===b.parent().parent().parent().children().length&&a.find("td.remove").html('<a href="#" class="location-remove-rule wcff-button-remove"></a>'),b.parent().parent().parent().append(a),a.find("select.wcff_location_param").trigger("change")},this.removeRule=function(a){var b=a.parent().parent().parent().parent();1===b.find("tr").size()?b.parent().remove():a.parent().parent().remove()},this.addConditionGroup=function(b){var a=$("div.wcff_logic_group:first").clone(!0);if(a.find("tr").size()>1){var c=a.find("tr:first").clone(!0);a.find("tbody").html("").append(c)}a.find("h4").html("or"),b.prev().before(a),a.find("td.remove").html('<a href="#" class="condition-remove-rule wcff-button-remove"></a>'),a.find("select.wcff_condition_param").trigger("change")},this.addLocationGroup=function(b){var a=$("div.wcff_location_logic_group:first").clone(!0);if(a.find("tr").size()>1){var c=a.find("tr:first").clone(!0);a.find("tbody").html("").append(c)}a.find("h4").html("or"),b.prev().before(a),a.find("td.remove").html('<a href="#" class="location-remove-rule wcff-button-remove"></a>'),a.find("select.wcff_condition_param").trigger("change")},this.addFieldLevelRule=function(b,a){var c="";(c="color-image"!==a?"datepicker"===this.activeField.type?this.buildPricingWidgetDatePicker(a):"checkbox"===this.activeField.type?this.buildPricingWidgetMultiChoices(a):"radio"===this.activeField.type||"select"===this.activeField.type?this.buildPricingWidgetChoice(a):this.buildPricingWidgetInput(a):this.addColorImageMapper(a))?(b.parent().find(".wcff-rule-container-is-empty").hide(),b.parent().find(".wcff-rule-container").append($(c))):b.parent().find(".wcff-rule-container-is-empty").show()},this.renderFieldLevelRules=function(c,b,f){var a="";if("text"===this.activeField.type||"number"===this.activeField.type||"textarea"===this.activeField.type||"file"===this.activeField.type)(a=$(this.buildPricingWidgetInput(c))).find("select.wcff-"+c+"-input-condition-value").val(b.logic),a.find("input.wcff-"+c+"-input-expected-value").val(this.unEscapeQuote(b.expected_value));else if("select"===this.activeField.type||"radio"===this.activeField.type)(a=$(this.buildPricingWidgetChoice(c))).find("select.wcff-"+c+"-choice-condition-value").val(b.logic),a.find("select.wcff-"+c+"-choice-expected-value").val(b.expected_value);else if("checkbox"===this.activeField.type){if((a=$(this.buildPricingWidgetMultiChoices(c))).find("select.wcff-"+c+"-multi-choice-condition-value").val(b.logic),b.expected_value)for(var d=0;d<b.expected_value.length;d++)a.find("input[type=checkbox][value='"+b.expected_value[d]+"']").prop("checked",!0)}else if("color-image"===c)(a=$(this.addColorImageMapper(c))).find(".wcff-color-image-select-container input[value='"+b.expected_value+"']").parent().addClass("color-active").children().prop("checked",!0),a.find(".wcff-color-image-toggle a").removeClass("selected"),a.find(".wcff-color-image-toggle a[data-type='"+b.image_or_url+"']").addClass("selected"),a.find(".wcff-prev-image").attr("src",b.prev_image_url),a.find(".wcff-image-url-holder").val(b.url),a.find(".wcff-upload-custom-img").addClass("hidden"),a.find(".wcff-delete-custom-img").removeClass("hidden");else{(a=$(this.buildPricingWidgetDatePicker(c))).find("ul.wcff-"+c+"-date-type-header li").removeClass("selected");var g=a.find("ul.wcff-"+c+"-date-type-header li[data-dtype='"+b.expected_value.dtype+"']").addClass("selected").index();if(a.find("div.wcff-factory-tab-right-panel > div").hide(),a.find("div.wcff-factory-tab-right-panel > div:nth-child("+(g+1)+")").show(),"days"===b.expected_value.dtype&&b.expected_value&&b.expected_value.value)for(var e=0;e<b.expected_value.value.length;e++)a.find("input[type=checkbox][value='"+b.expected_value.value[e]+"']").prop("checked",!0);else"specific-dates"===b.expected_value.dtype?a.find("textarea.wcff-field-type-meta-specific_dates").val(b.expected_value.value):"weekends-weekdays"===b.expected_value.dtype?a.find("input[type=radio][value='"+b.expected_value.value+"']").prop("checked",!0):a.find("textarea.wcff-field-type-meta-specific_date_each_months").val(b.expected_value.value)}"pricing"===c?(a.find("input.wcff-pricing-rules-title").val(this.unEscapeQuote(b.title)),a.find("div.calculation-mode > a").removeClass("selected"),a.find("div.calculation-mode > a[data-ptype="+b.ptype+"]").addClass("selected"),a.find("div.amount-mode > a").removeClass("selected"),a.find("div.amount-mode > a[data-tprice="+b.tprice+"]").addClass("selected")):"fee"===c&&(a.find("input.wcff-fee-rules-title").val(this.unEscapeQuote(b.title)),a.find("div.amount-mode > a").removeClass("selected"),a.find("div.amount-mode > a[data-tprice="+b.tprice+"]").addClass("selected"),a.find("div.calculation-mode > a").removeClass("selected"),a.find("div.calculation-mode > a[data-is_tx="+b.is_tx+"]").addClass("selected")),a.find("input.wcff-"+c+"-rules-amount").val(b.amount),f.append(a)},this.buildPricingWidgetInput=function(b){var a='<div class="wcff-'+b+'-row">';return a+='<table class="wcff-'+b+'-table"><tr>',a+='<td class="context">',a+='<div class="rule-section">',"number"===this.activeField.type?a+="<label>If user entered number</label>":"colorpicker"===this.activeField.type?a+="<label>If user picked color</label>":a+="<label>If user entered text</label>",a+='<select class="wcff-'+b+'-input-condition-value">',"number"===this.activeField.type?(a+='<option value="equal">is equal to</option>',a+='<option value="not-equal">is not equal to</option>',a+='<option value="less-than">less than</option>',a+='<option value="less-than-equal">less than or equal to</option>',a+='<option value="greater-than">greater than</option>',a+='<option value="greater-than-equal">greater than or equal to</option>'):(a+='<option value="equal">is equal to</option>',a+='<option value="not-equal">is not equal to</option>'),a+='<option value="null">is null</option>',a+='<option value="not-null">is not null</option>',a+="</select>",a+='</div><div class="rule-section">',a+="<label>Expected value</label>","colorpicker"!=this.activeField.type?a+='<input type="'+("textarea"==this.activeField.type?"text":this.activeField.type)+'" class="wcff-'+b+'-input-expected-value" value="">':a+='<input type="text" class="wcff-'+b+'-input-expected-value" value="" placeholder="Expected Color.? (Use comma if more then one color value)" />',a+="</div></td>","field"!==b?(a+='<td class="pricing">'+this.buildAmountWidget(b)+"</td>",a+='<td class="mode">'+this.buildCalculationModeWidget(b)+"</td></tr></table>"):a+='<td class="field">'+this.buildFieldsRuleSetter()+"</td></tr></table>",a+='<a href="#" class="pricing-remove-rule wcff-button-remove"></a>',a+="</div>"},this.buildPricingWidgetChoice=function(b){var c=0,f=[],a="",d=[],g=!1,e=this.activeRow.find("textarea.wcff-field-type-meta-choices").val();if(!e||""==e)return alert("Please add some options to this "+this.activeField.type+" Field.!"),null;if(d=e.trim().split("\n"),g=this.isNumberChoices(e),a='<div class="wcff-'+b+'-row">',a+='<table class="wcff-'+b+'-table"><tr>',a+='<td class="context">',a+='<div class="rule-section">',a+="<label>If user's selected option</label>",a+='<select class="wcff-'+b+'-choice-condition-value">',g?(a+='<option value="equal">is equal to</option>',a+='<option value="not-equal">is not equal to</option>',a+='<option value="less-than">less than</option>',a+='<option value="less-than-equal">less than or equal to</option>',a+='<option value="greater-than">greater than</option>',a+='<option value="greater-than-equal">greater than or equal to</option>'):(a+='<option value="equal">is equal to</option>',a+='<option value="not-equal">is not equal to</option>'),a+="</select></div>",a+='<div class="rule-section">',a+="<label>Expected option</label>",a+='<select class="wcff-'+b+'-choice-expected-value">',d)for(c=0;c<d.length;c++)a+='<option value="'+(f=d[c].split("|"))[0]+'">'+f[1]+"</option>";return a+="</select></div></td>","field"!==b?(a+='<td class="pricing">'+this.buildAmountWidget(b)+"</td>",a+='<td class="mode">'+this.buildCalculationModeWidget(b)+"</td></tr></table>"):a+='<td class="field">'+this.buildFieldsRuleSetter()+"</td></tr></table>",a+='<a href="#" class="pricing-remove-rule wcff-button-remove"></a>',a+="</div>"},this.buildPricingWidgetMultiChoices=function(b){var c=0,f=[],a="",d=[],e=this.activeRow.find("textarea.wcff-field-type-meta-choices").val();if(!e||""==e)return alert("Please add some options to this "+this.activeField.type+" Field.!"),null;for(d=e.trim().split("\n"),a='<div class="wcff-'+b+'-row">',a+='<table class="wcff-'+b+'-table"><tr>',a+='<td class="context">',a+='<div class="rule-section">',a+="<label>The option chosen by user</label>",a+='<select class="wcff-'+b+'-multi-choice-condition-value">',a+='<option value="has-options">Checked</option>',a+='<option value="has-not-options">Not Checked</option>',a+="</select></div>",a+='<div class="rule-section">',a+="<label>Expected option</label>",a+='<ul class="wcff-'+b+'-multi-choices-ul">',c=0;c<d.length;c++)a+='<li><label><input type="checkbox" name="wcff-'+b+'-multi-choice-expected-value" value="'+(f=d[c].split("|"))[0]+'" /> '+f[1]+"</label></li>";return a+="</ul>",a+="</div></td>","field"!==b?(a+='<td class="pricing">'+this.buildAmountWidget(b)+"</td>",a+='<td class="mode">'+this.buildCalculationModeWidget(b)+"</td></tr></table>"):a+='<td class="field">'+this.buildFieldsRuleSetter()+"</td></tr></table>",a+='<a href="#" class="pricing-remove-rule wcff-button-remove"></a>',a+="</div>"},this.buildPricingWidgetDatePicker=function(b){var a='<div class="wcff-'+b+'-row">';return a+='<table class="wcff-'+b+'-table data-picker-pricing-rule"><tr>',a+='<td class="date-context">',a+='<div class="rule-section">',a+='<div class="wcff-factory-tab-container">',a+='<div class="wcff-factory-tab-left-panel">',a+='<ul class="wcff-'+b+'-date-type-header">',a+='<li class="selected" data-dtype="days">Days</li>',a+='<li data-dtype="specific-dates">Specific Dates</li>',a+='<li data-dtype="weekends-weekdays">Weekends Or Weekdays</li>',a+='<li data-dtype="specific-dates-each-month">Specific Dates Each Months</li>',a+="</ul>",a+="</div>",a+='<div class="wcff-factory-tab-right-panel">',a+='<div class="wcff-factory-tab-content" style="display: block;">',a+='<div class="wcff-field-types-meta">',a+='<ul class="wcff-field-layout-horizontal">',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="sunday"> Sunday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="monday"> Monday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="tuesday"> Tuesday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="wednesday"> Wednesday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="thursday"> Thursday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="friday"> Friday</label></li>',a+='<li><label><input type="checkbox" name="wcff-field-type-meta-'+b+'-disable_days[]" value="saturday"> Saturday</label></li>',a+="</ul>",a+="</div>",a+="</div>",a+='<div class="wcff-factory-tab-content" style="display: none;">',a+='<div class="wcff-field-types-meta">',a+='<textarea class="wcff-field-type-meta-specific_dates" placeholder="Format: MM-DD-YYYY Example: 1-22-2017,10-7-2017" rows="2"></textarea>',a+="</div>",a+="</div>",a+='<div class="wcff-factory-tab-content" style="display: none;">',a+='<div class="wcff-field-types-meta">',a+='<ul class="wcff-field-layout-horizontal">',a+='<li><label><input type="radio" name="wcff-field-type-meta-'+b+'-weekend_weekdays" class="wcff-field-type-meta-weekend_weekdays" value="weekends"> Week Ends</label></li>',a+='<li><label><input type="radio" name="wcff-field-type-meta-'+b+'-weekend_weekdays" class="wcff-field-type-meta-weekend_weekdays" value="weekdays"> Week Days</label></li>',a+="</ul>",a+="</div>",a+='<div class="wcff-field-types-meta" data-type="html"><a href="#" class="wcff-date-disable-radio-clear button">Clear</a></div>',a+="</div>",a+='<div class="wcff-factory-tab-content" style="display: none;">',a+='<div class="wcff-field-types-meta">',a+='<textarea class="wcff-field-type-meta-specific_date_each_months" placeholder="Example: 5,10,12" rows="2"></textarea>',a+="</div>",a+="</div>",a+="</div>",a+="</div>",a+="</div></td>","field"!==b?(a+='<td class="pricing">'+this.buildAmountWidget(b)+"</td>",a+='<td class="mode">'+this.buildCalculationModeWidget(b)+"</td></tr></table>"):a+='<td class="field">'+this.buildFieldsRuleSetter()+"</td></tr></table>",a+='<a href="#" class="pricing-remove-rule wcff-button-remove"></a>',a+="</div>"},this.buildAmountWidget=function(b){var a='<div class="rule-section">';return a+="<label>Title</label>",a+='<input type="text" class="wcff-'+b+'-rules-title" value="">',a+='</div><div class="rule-section">',a+="<label>Amount</label>",a+='<input type="number" class="wcff-'+b+'-rules-amount" value="" step="any">',a+="</div>"},this.buildCalculationModeWidget=function(b){var a='<div class="rule-section">';return a+="<label>Amount Mode</label>",a+='<div class="wcff-rule-toggle amount-mode '+b+'-amount-mode">',a+='<a href="#" data-tprice="cost" title="Amount should be added or subtracted or replced with the Original Price" class="price-is-amount selected">Cost</a>',a+='<a href="#" data-tprice="percentage" title="Amount should act as a Percent - which will be added or subtracted with the Original Price" class="price-is-percentage">%</a>',a+="</div></div>",a+='<div class="rule-section">',a+="<label>Calculation Mode</label>",a+='<div class="wcff-rule-toggle calculation-mode">',"pricing"===b?(a+='<a href="#" data-ptype="add" title="Add this amount (or percent) with product original price" class="price-rule-add selected">Add</a>',a+='<a href="#" data-ptype="sub" title="Subtract this amount (or percent) with product original price" class="price-rule-add">Sub</a>',a+='<a href="#" data-ptype="change" title="Replace the original product price with this amount" class="price-rule-change">Replace</a>'):(a+='<a href="#" data-is_tx="tax" title="Is taxable" class="fee-is-tax">Tax</a>',a+='<a href="#" data-is_tx="non_tax" title="Is non-taxable" class="fee-is-non_tax">Non Tax</a>'),a+="</div></div>"},this.buildFieldsRuleSetter=function(){var b=0,a="",c="",d=null,e=$("#wcff-fields-set .wcff-meta-row:not(.active)");for(a+='<table class="wcff-fields-visibility-widget-table"><tbody>',b=0;b<e.length;b++)c=(d=$(e[b])).attr("data-key"),a+="<tr>",a+='<td class="toggle-field-label-col">',a+="<label>"+(0!=d.find(".wcff-field-label").find("input").length?d.find(".wcff-field-label").find("input").val():d.find(".wcff-field-label").text())+" => <label>",a+="</td>",a+='<td class="toggle-widget-col">',a+='<div class="wcff-field-type-of-field-toggle fields-mode wcff-rule-toggle"><a href="#" data-field_label="'+c+'" data-vfield="show" title="Show Field" class="field-show">Show</a><a href="#" data-vfield="hide" data-field_label="'+c+'" title="Hide Field" class="field-hide">Hide</a><a href="#" data-vfield="Nill" data-field_label="'+c+'" title="No rule" class="field-nill-rule selected">Nill</a></div>',a+="</td>",a+="</tr>";return a+"</tbody></table>"},this.addColorImageMapper=function(d){""==this.activeRow.find("[name=wcff-field-type-meta-palettes]").val()&&alert("Please add some colors to the palette option.!");var a='<div class="wcff-'+d+'-row">';a+='<table class="wcff-'+d+'-table"><tr>',a+='<td class="context">',a+='<div class="rule-section">',a+="<label>User's chosen color is</label>",a+='<select class="wcff-'+d+'-input-condition-value">',a+='<option value="equal">is equal to</option>',a+='<option value="default">default image</option>',a+="</select></div>",a+='<div class="rule-section">',a+='<div class="wcff-color-image-select-container">';var c=0,f="",b="",e=[];for(c=0,e=this.activeRow.find("[name=wcff-field-type-meta-palettes]").val().trim().replace("\n",",").split(",");c<e.length;c++)a+='<label style="background-color: '+(f=4==(b=e[c].trim()).length&&b.length>=4?"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]:b)+'; "><input type="radio" value="'+f+'"></label>';return a+="</div>",a+='</div></td><td class="image">',a+='<div class="rule-section">',a+='<table class="img-mapper-upload-table"><tr>',a+="<td><label>Then replace the product image to =></label></td>",a+='<td><div class="rule-section">',a+='<div class="hide-if-no-js wcff-image-selector-container"><div class=""><img class="wcff-prev-image" src="'+wcff_var.plugin_dir+'/assets/img/placeholder-image.jpg" alt="" style="width:80px;"><input type="hidden" class="wcff-image-url-holder"></div><div class=""><a class="wcff-upload-custom-img button"  href="#"> Add </a><a class="wcff-delete-custom-img hidden button" href="#"> Remove </a> </div></div><div class="wcff-url-selector-container" style="display:none;"><input type="text" class="wcff-product-color-url" placeholder="Paste another product url here"></div>',a+="</div></td>",a+="</tr></table>",a+="",a+="</div>",a+="</td></tr></table></div>"},this.dropNewField=function(){var b=this.draggedField.attr("value").trim(),a='<div class="wcff-meta-row active wcff-field-config-drawer-opened" data-key="" data-type="'+b+'" data-unremovable="false" data-is_enable="true">';a+='<table class="wcff_table">',a+="<tbody>",a+="<tr>",a+='<td class="field-order wcff-sortable">',a+='<span class="wcff-field-order-number wcff-field-order">4</span>',a+="</td>",a+='<td class="field-label">',a+='<label class="wcff-field-label" data-key=""><input type="text" name="wcff-field-type-meta-label-temp" class="wcff-field-type-meta-label-temp" value="" autocomplete="off"></label></td>',a+='<td class="field-type">',a+='<label class="wcff-field-type"><span style="background: url('+wcff_var.asset_url+"/img/"+b+'.png) no-repeat left;"></span>'+b+"</label>",a+="</td>",a+='<td class="field-actions">',a+='<div class="wcff-meta-option">',a+='<label class="wcff-switch" data-key=""> <input class="wcff-toggle-check" type="checkbox" checked=""> <span class="slider round"></span> </label>',a+='<a href="#" data-key="" class="wcff-field-delete button" style="display: none;">x</a>',a+="</div>",a+="</td>",a+="</tr>",a+="</tbody>",a+="</table>",a+='<input type="hidden" name="wcff-field-order-index" class="wcff-field-order-index" value="0">',a+="</div>",a=$(a),this.placeHolder.after(a);var c="wcccf"==wcff_var.post_type?1:0;$("div.wcff-meta-row").each(function(){!$(this).is("#wcff-add-field-placeholder")&&($(this).find("input.wcff-field-order-index").val(c),$(this).find("span.wcff-field-order-number").text("wcccf"==wcff_var.post_type?c:c+1),c++)}),this.prepareRequest("POST","field",{type:b,order:a.find("input.wcff-field-order-index").val()},a),this.mask.doMask(a),this.dock()},this.prepareConfigWidget=function(a){this.emptyNotice.hide(),"wccpf"===wcff_var.post_type&&("file"===this.activeField.type&&this.target.find("div[data-param=img_is_prev_width]").hide(),this.target.find(".wcff-factory-multilingual-label-btn").length>0&&("hidden"===this.activeField.type||"label"===this.activeField.type?this.target.find(".wcff-factory-multilingual-label-btn").hide():this.target.find(".wcff-factory-multilingual-label-btn").show())),"wccaf"===wcff_var.post_type&&(this.target.find("div.wcff-field-types-meta").each(function(){("visibility"===$(this).attr("data-param")||"login_user_field"===$(this).attr("data-param")||"cart_editable"===$(this).attr("data-param")||"cloneable"===$(this).attr("data-param")||"show_as_read_only"===$(this).attr("data-param")||"hide_when_no_value"===$(this).attr("data-param")||"show_with_value"===$(this).attr("data-param")||"showin_value"===$(this).attr("data-param"))&&$(this).closest("tr").hide(),a&&$(this).find("input[name=options-order_meta][value='no']").prop("checked",!0)}),"url"===this.activeField.type&&this.target.find("div.wcff-field-types-meta").each(function(){("login_user_field"===$(this).attr("data-param")||"cloneable"===$(this).attr("data-param"))&&$(this).closest("tr").show()}))},this.constructDropZone=function(){1==$("div.wcff-layout-form-row").length?$("div.wcff-layout-form-row > div").length>0?($("div.wcff-layout-form-row").append($('<div class="dropzone"></div>')),$("#wcff-layout-designer-pad").append($('<div class="wcff-layout-form-row"><div class="dropzone"></div></div>'))):$("div.wcff-layout-form-row").append($('<div class="dropzone"></div>')):($("div.wcff-layout-form-row").append($('<div class="dropzone"></div>')),$("#wcff-layout-designer-pad").append($('<div class="wcff-layout-form-row"><div class="dropzone"></div></div>'))),$("div.wcff-layout-form-row > div.dropped").each(function(){$(this).attr("data-width",$(this).css("flex-basis")),$(this).css("flex-basis","")}),this.layout.rows.push([])},this.handleDropField=function(b){me=this,this.dropZone.html(b),this.dropZone.attr("data-fkey",this.draggedField.attr("data-fkey")),this.dropZone.append($('<a href="#" class="delete-field" title="Remove">X</a>')),this.dropZone.parent().find("> div.dropped").length>1&&this.dropZone.before($('<div class="handlebar"></div>')),this.layout.rows[this.dropZone.parent().index()].push(this.draggedField.attr("data-fkey")),this.layout.columns[this.draggedField.attr("data-fkey")]={width:0};var d=this.dropZone.parent().width(),c=this.dropZone.parent().find("> div.handlebar").length,e=6*c;this.dropZone.parent().find("> div.dropped").each(function(){var a=(parseInt($(this).width())+parseInt(c>0?e/c:0))/d;me.layout.columns[$(this).attr("data-fkey")].width=100*a});for(var a=0;a<this.layout.rows.length;a++)0==this.layout.rows[a].length&&this.layout.rows.splice(a,1);this.draggedField.remove(),0==$("#wcff-layout-designer-field-list > a").length&&$("#wcff-layout-designer-field-list").html("<h3>All fields are used.!</h3>")},this.destructDropZone=function(){$("div.wcff-layout-form-row > div.dropzone").remove(),$("div.wcff-layout-form-row").length>1&&$("div.wcff-layout-form-row").each(function(){0!=$(this).index()&&0==$(this).find("> div").length&&$(this).remove()})},this.renderSingleView=function(){var a=0,f=0,c="",q=this,b=[],d=[],e=null,g=null,i=this.target.find(".wcff-default-option-holder");if($("html,body").animate({scrollTop:this.target.offset().top-50},"slow"),this.activeField.locale)for(a=0;a<wcff_var.locales.length;a++)this.target.find("[name=wcff-field-type-meta-label-"+wcff_var.locales[a]+"]").length>0&&this.activeField.locale[wcff_var.locales[a]]&&this.activeField.locale[wcff_var.locales[a]].label&&this.target.find("[name=wcff-field-type-meta-label-"+wcff_var.locales[a]+"]").val(this.activeField.locale[wcff_var.locales[a]].label);if("datepicker"===this.activeField.type&&$("div.wcff-factory-tab-right-panel").find("div.wcff-field-types-meta").each(function(){if(""!==$(this).attr("data-param")){$(this).attr("data-param");var a=$(this).attr("data-type");"checkbox"===a||"radio"===a?$(this).find("input[type="+a+"]").prop("checked",!1):$(this).find(a).val("")}}),this.target.find(".wcff-field-types-meta-body div.wcff-field-types-meta").each(function(){if(q.activeField[$(this).attr("data-param")]){if(("choices"===$(this).attr("data-param")||"palettes"===$(this).attr("data-param"))&&(q.activeField[$(this).attr("data-param")]=q.activeField[$(this).attr("data-param")].replace(/;/g,"\n")),"checkbox"===$(this).attr("data-type")){var b=q.activeField[$(this).attr("data-param")];if(b)for(a=0;a<b.length;a++)$(this).find("input.wcff-field-type-meta-"+$(this).attr("data-param")+"[value='"+b[a]+"']").prop("checked",!0)}else"radio"===$(this).attr("data-type")?($(this).find(".wcff-field-type-meta-"+$(this).attr("data-param")+"[value='"+q.activeField[$(this).attr("data-param")]+"']").prop("checked",!0),$(this).find(".wcff-field-type-meta-"+$(this).attr("data-param")+"[value='"+q.activeField[$(this).attr("data-param")]+"']").trigger("change")):"html"!==$(this).attr("data-type")&&$(this).find(".wcff-field-type-meta-"+$(this).attr("data-param")).val(q.unEscapeQuote(q.activeField[$(this).attr("data-param")]))}}),q.activeField.locale)for(a=0;a<wcff_var.locales.length;a++)this.target.find("div.wcff-locale-block").each(function(){0!=$(this).find("[name=wcff-field-type-meta-"+$(this).attr("data-param")+"-"+wcff_var.locales[a]+"]").length&&("choices"===$(this).attr("data-param")&&q.activeField.locale[wcff_var.locales[a]]&&q.activeField.locale[wcff_var.locales[a]][$(this).attr("data-param")]&&(console.log("Its a choice"),q.activeField.locale[wcff_var.locales[a]][$(this).attr("data-param")]=q.activeField.locale[wcff_var.locales[a]][$(this).attr("data-param")].replace(/;/g,"\n")),q.activeField.locale[wcff_var.locales[a]]&&q.activeField.locale[wcff_var.locales[a]][$(this).attr("data-param")]&&$(this).find("[name=wcff-field-type-meta-"+$(this).attr("data-param")+"-"+wcff_var.locales[a]+"]").val(q.activeField.locale[wcff_var.locales[a]][$(this).attr("data-param")]))});if(void 0!==this.activeField.login_user_field&&"yes"==this.activeField.login_user_field&&this.target.find("div.wcff-field-types-meta[data-param=show_for_roles]").closest("tr").show(),i.html(""),"checkbox"===this.activeField.type&&this.activeField.choices&&""!=this.activeField.choices){if(e=[],this.activeField.default_value){if(g=this.activeField.default_value,"[object Array]"!==Object.prototype.toString.call(g))for(a=0,g=g.split(";");a<g.length;a++)2===(b=g[a].trim().split("|")).length&&e.push(b[0].trim());else e=this.activeField.default_value}for(a=0,d=this.activeField.choices.split("\n"),c="<ul>";a<d.length;a++)2===(b=d[a].split("|")).length&&(e.indexOf(b[0])> -1?c+='<li><input type="checkbox" value="'+this.unEscapeQuote(b[0])+'" checked /> '+this.unEscapeQuote(b[1])+"</li>":c+='<li><input type="checkbox" value="'+this.unEscapeQuote(b[0])+'" /> '+this.unEscapeQuote(b[1])+"</li>");if(c+="</ul>",i.html(c),this.activeField.locale){for(a=0;a<wcff_var.locales.length;a++)if(this.activeField.locale[wcff_var.locales[a]]&&this.activeField.locale[wcff_var.locales[a]].choices&&""!=this.activeField.locale[wcff_var.locales[a]].choices){for(f=0,d=this.activeField.locale[wcff_var.locales[a]].choices.split("\n"),e=this.activeField.locale[wcff_var.locales[a]].default_value?this.activeField.locale[wcff_var.locales[a]].default_value:"",c="<ul>";f<d.length;f++)2===(b=d[f].split("|")).length&&(e.indexOf(b[0])> -1?c+='<li><input type="checkbox" value="'+this.unEscapeQuote(b[0])+'" checked /> '+this.unEscapeQuote(b[1])+"</li>":c+='<li><input type="checkbox" value="'+this.unEscapeQuote(b[0])+'" /> '+this.unEscapeQuote(b[1])+"</li>");c+="</ul>",this.target.find(".wcff-default-option-holder-"+wcff_var.locales[a]).html(c)}}}if("radio"===this.activeField.type&&this.activeField.choices&&""!=this.activeField.choices){for(e="",this.activeField.default_value&&(-1!=this.activeField.default_value.indexOf("|")?2===(b=this.activeField.default_value.trim().split("|")).length&&(e=b[0]):e=this.activeField.default_value.trim()),d=this.activeField.choices.split("\n"),c="<ul>",a=0;a<d.length;a++)2===(b=d[a].split("|")).length&&(e===b[0]?c+='<li><input name="wcff-default-choice" type="radio" value="'+this.unEscapeQuote(b[0])+'" checked /> '+this.unEscapeQuote(b[1])+"</li>":c+='<li><input name="wcff-default-choice" type="radio" value="'+this.unEscapeQuote(b[0])+'" /> '+this.unEscapeQuote(b[1])+"</li>");if(c+="</ul>",i.html(c),this.activeField.locale){for(a=0;a<wcff_var.locales.length;a++)if(this.activeField.locale[wcff_var.locales[a]]&&this.activeField.locale[wcff_var.locales[a]].choices&&""!=this.activeField.locale[wcff_var.locales[a]].choices){for(f=0,d=this.activeField.locale[wcff_var.locales[a]].choices.split("\n"),e=this.activeField.locale[wcff_var.locales[a]].default_value?this.activeField.locale[wcff_var.locales[a]].default_value:"",c="<ul>";f<d.length;f++)2===(b=d[f].split("|")).length&&(e===b[0]?c+='<li><input name="wcff-default-choice-'+wcff_var.locales[a]+'" type="radio" value="'+this.unEscapeQuote(b[0])+'" checked /> '+this.unEscapeQuote(b[1])+"</li>":c+='<li><input name="wcff-default-choice-'+wcff_var.locales[a]+'" type="radio" value="'+this.unEscapeQuote(b[0])+'" /> '+this.unEscapeQuote(b[1])+"</li>");c+="</ul>",this.target.find(".wcff-default-option-holder-"+wcff_var.locales[a]).html(c)}}this.activeField.render_method&&"none"!=this.activeField.render_method&&($("#wcff-render-option-label-position").val(this.activeField.preview_label_pos),"yes"==this.activeField.show_preview_label?$("#wcff-option-render-label").prop("checked",!0):$("#wcff-option-render-label").prop("checked",!1),$("#wcff-option-render-label").trigger("change"))}if("select"===this.activeField.type&&this.activeField.choices){for(e="",this.activeField.default_value&&(-1!=this.activeField.default_value.indexOf("|")?2===(b=this.activeField.default_value.trim().split("|")).length&&(e=b[0]):e=this.activeField.default_value.trim()),d=this.activeField.choices.split("\n"),c="<select>",c+='<option value="">-- Choose the default Option --</option>',a=0;a<d.length;a++)2===(b=d[a].split("|")).length&&(e===b[0]?c+='<option value="'+this.unEscapeQuote(b[0])+'" selected>'+this.unEscapeQuote(b[1])+"</option>":c+='<option value="'+this.unEscapeQuote(b[0])+'">'+this.unEscapeQuote(b[1])+"</option>");if(c+="</select>",i.html(c),this.activeField.locale){for(a=0;a<wcff_var.locales.length;a++)if(this.activeField.locale[wcff_var.locales[a]]&&this.activeField.locale[wcff_var.locales[a]].choices&&""!=this.activeField.locale[wcff_var.locales[a]].choices){for(d=this.activeField.locale[wcff_var.locales[a]].choices.split("\n"),e=this.activeField.locale[wcff_var.locales[a]].default_value?this.activeField.locale[wcff_var.locales[a]].default_value:"",c="<select>",c+='<option value="">-- Choose the default Option --</option>',f=0;f<d.length;f++)2===(b=d[f].split("|")).length&&(e===b[0]?c+='<option value="'+this.unEscapeQuote(b[0])+'" selected>'+this.unEscapeQuote(b[1])+"</option>":c+='<option value="'+this.unEscapeQuote(b[0])+'">'+this.unEscapeQuote(b[1])+"</option>");c+="</select>",this.target.find(".wcff-default-option-holder-"+wcff_var.locales[a]).html(c)}}}if("file"===this.activeField.type){var o=$("input[name=wcff-field-type-meta-img_is_prev]:checked").val();o&&"yes"===o?$("div[data-param=img_is_prev_width]").show():$("div[data-param=img_is_prev_width]").hide()}if("datepicker"===this.activeField.type){var p=$("input[name=wcff-field-type-meta-timepicker]:checked").val();if(p&&"yes"===p?$("div[data-param=min_max_hours_minutes]").closest("tr").css("display","table-row"):$("div[data-param=min_max_hours_minutes]").closest("tr").css("display","none"),this.activeField.min_max_hours_minutes&&""!==this.activeField.min_max_hours_minutes){var h=this.activeField.min_max_hours_minutes.split("|");h instanceof Array&&(h.length>=1&&$("#wccpf-datepicker-min-max-hours").val(h[0]),h.length>=2&&$("#wccpf-datepicker-min-max-minutes").val(h[1]))}$("[data-box=#wcff-date-field-disable-past-future-dates]").trigger("click")}if("yes"===this.target.find("input[name=wcff-field-type-meta-login_user_field]:checked").val()?this.target.find(".div[data-param=show_for_roles]").closest("tr").css("display","table-row"):this.target.find(".div[data-param=show_for_roles]").closest("tr").css("display","none"),"wccpf"===wcff_var.post_type||"wccvf"===wcff_var.post_type){var j=this.activeField.pricing_rules;if("[object Array]"===Object.prototype.toString.call(j)){for(a=0;a<j.length;a++)this.renderFieldLevelRules("pricing",j[a],this.target.find(".wcff-add-price-rule-btn").parent().find(".wcff-rule-container"));0!=j.length&&this.target.find(".wcff-add-price-rule-btn").parent().find(".wcff-rule-container-is-empty").hide()}var k=this.activeField.fee_rules;if("[object Array]"===Object.prototype.toString.call(k)){for(a=0;a<k.length;a++)this.renderFieldLevelRules("fee",k[a],this.target.find(".wcff-add-fee-rule-btn").parent().find(".wcff-rule-container"));0!=k.length&&this.target.find(".wcff-add-fee-rule-btn").parent().find(".wcff-rule-container-is-empty").hide()}var l=this.activeField.field_rules;if("[object Array]"===Object.prototype.toString.call(l)){for(a=0;a<l.length;a++)this.renderFieldLevelRules("field",l[a],this.target.find(".wcff-add-field-rule-btn").parent().find(".wcff-rule-container"));for(var n=this.target.find(".wcff-tab-rules-wrapper.field .wcff-field-row"),a=0;a<n.length;a++)for(var f in this.activeField.field_rules[a].field_rules)$(n[a]).find("a[data-field_label='"+f+"']").siblings().removeClass("selected"),$(n[a]).find("a[data-field_label='"+f+"'][data-vfield="+this.activeField.field_rules[a].field_rules[f]+"]").addClass("selected");0!=l.length&&this.target.find(".wcff-add-field-rule-btn").parent().find(".wcff-rule-container-is-empty").hide()}"colorpicker"==this.activeField.type&&this.activeField.palettes&&(this.activeField.choices=this.activeField.palettes.replace(/\n/g,","));var m=this.activeField.color_image;if("[object Array]"===Object.prototype.toString.call(m)){for(a=0;a<m.length;a++)this.renderFieldLevelRules("color-image",m[a],this.target.find(".wcff-add-color-image-rule-btn").parent().find(".wcff-rule-container"));0!=m.length&&this.target.find(".wcff-add-color-image-rule-btn").parent().find(".wcff-rule-container-is-empty").hide()}}if("wccaf"===wcff_var.post_type&&this.activeField.show_on_product_page){var r="table-row";"no"===this.activeField.show_on_product_page&&(r="none"),this.target.find("div.wcff-field-types-meta").each(function(){var a=!1;("visibility"===$(this).attr("data-param")||"login_user_field"===$(this).attr("data-param")||"cart_editable"===$(this).attr("data-param")||"cloneable"===$(this).attr("data-param")||"show_as_read_only"===$(this).attr("data-param")||"hide_when_no_value"===$(this).attr("data-param")||"show_with_value"===$(this).attr("data-param")||"showin_value"===$(this).attr("data-param"))&&(a=!0),a&&$(this).closest("tr").css("display",r)})}"email"!==this.activeField.type&&"label"!==this.activeField.type&&"hidden"!==this.activeField.type?this.target.find(".wcff-factory-tab-header a[href='.wcff-factory-tab-pricing-rules'], .wcff-factory-tab-header a[href='.wcff-factory-tab-fields-rules']").show():this.target.find(".wcff-factory-tab-header a[href='.wcff-factory-tab-pricing-rules'], .wcff-factory-tab-header a[href='.wcff-factory-tab-fields-rules']").hide(),"colorpicker"==this.activeField.type&&"yes"==this.activeField.show_palette_only&&this.target.find(".wcff-factory-tab-header").find("a[href='.wcff-factory-tab-color-image']").show()},this.updateField=function(){this.activeField=this.fetchFieldConfig(),this.dirtyFields[this.activeField.key]=this.activeField},this.fetchFieldConfig=function(){var b=0,j=this,g="",a={},c={},h={},d=null,i=null,e="0:23",f="0:59";if(this.activeRow){if(a.key=this.activeRow.attr("data-key"),a.type=this.activeRow.attr("data-type"),g=0==this.activeRow.find(".field-label .wcff-field-label input").length?this.activeRow.find(".field-label .wcff-field-label").text():this.activeRow.find(".field-label .wcff-field-label input").val(),a.label=this.escapeQuote(g),a.order=this.activeRow.find("input.wcff-field-order-index").val(),a.is_enable="true"==this.activeRow.attr("data-is_enable"),a.is_unremovable="true"==this.activeRow.attr("data-unremovable"),0==this.activeRow.find(".wcff-field-types-meta-body").length)return!1;for(this.activeRow.find(".wcff-field-types-meta-body div.wcff-field-types-meta").each(function(){"checkbox"===$(this).attr("data-type")?a[$(this).attr("data-param")]=$(this).find("input.wcff-field-type-meta-"+$(this).attr("data-param")+":checked").map(function(){return j.escapeQuote(this.value)}).get():"radio"===$(this).attr("data-type")?a[$(this).attr("data-param")]=j.escapeQuote(j.activeRow.find("input[type=radio].wcff-field-type-meta-"+$(this).attr("data-param")+":checked").val()):"html"!==$(this).attr("data-type")&&(a[$(this).attr("data-param")]=j.escapeQuote(j.activeRow.find("[name=wcff-field-type-meta-"+$(this).attr("data-param")+"]").val()),("choices"===$(this).attr("data-param")||"palettes"===$(this).attr("data-param"))&&(a[$(this).attr("data-param")]=a[$(this).attr("data-param")].replace(/\n/g,";")))}),"datepicker"===a.type&&(e="0:23",f="0:59","yes"==(i=this.activeRow.find("input[name=options-timepicker]:checked").val())&&(""!=this.activeRow.find(".wccpf-datepicker-min-max-hours").val()&&(e=this.activeRow.find(".wccpf-datepicker-min-max-hours").val()),""!=this.activeRow.find(".wccpf-datepicker-min-max-minutes").val()&&(f=this.activeRow.find(".wccpf-datepicker-min-max-minutes").val())),a.timepicker=i,a.min_max_hours_minutes=e+"|"+f),b=0;b<wcff_var.locales.length;b++)h={},this.activeRow.find("div.wcff-locale-block").each(function(){0!=$(this).find("[name=wcff-field-type-meta-"+$(this).attr("data-param")+"-"+wcff_var.locales[b]+"]").length&&(h[$(this).attr("data-param")]=$(this).find("[name=wcff-field-type-meta-"+$(this).attr("data-param")+"-"+wcff_var.locales[b]+"]").val(),"choices"===$(this).attr("data-param")&&(h[$(this).attr("data-param")]=h[$(this).attr("data-param")].replace(/\n/g,";")))}),c[wcff_var.locales[b]]=h;if(d=this.activeRow.find(".wcff-default-option-holder"),"checkbox"===a.type)for(b=0,a.default_value=d.find("input[type=checkbox]:checked").map(function(){return j.escapeQuote(this.value)}).get();b<wcff_var.locales.length;b++)c[wcff_var.locales[b]].default_value=this.activeRow.find(".wcff-default-option-holder-"+wcff_var.locales[b]).find("input[type=checkbox]:checked").map(function(){return j.escapeQuote(this.value)}).get();if("radio"===a.type){for(b=0,a.default_value=this.escapeQuote(d.find("input[type=radio]:checked").val());b<wcff_var.locales.length;b++)c[wcff_var.locales[b]].default_value=this.escapeQuote(this.activeRow.find(".wcff-default-option-holder-"+wcff_var.locales[b]).find("input[type=radio]:checked").val());a.show_preview_label=$("#wcff-option-render-label").is(":checked")?"yes":"no","yes"==a.show_preview_label&&(a.preview_label_pos=$("#wcff-render-option-label-position").val()),a.images||(a.images={}),this.activeField.images&&(a.images=this.activeField.images)}if("select"===a.type)for(b=0,a.default_value=this.escapeQuote(d.find("select").val());b<wcff_var.locales.length;b++)c[wcff_var.locales[b]].default_value=this.escapeQuote(this.activeRow.find(".wcff-default-option-holder-"+wcff_var.locales[b]).find("select").val());a.locale=c,this.activeRow.find("div.wcff-pricing-row").each(function(){j.fetchRules($(this),"pricing")}),this.activeRow.find("div.wcff-fee-row").each(function(){j.fetchRules($(this),"fee")}),this.activeRow.find("div.wcff-field-row").each(function(){j.fetchRules($(this),"field")}),this.activeRow.find("div.wcff-color-image-row").each(function(){j.fetchRules($(this),"color-image")}),this.pricingRules.length>0&&(a.pricing_rules=JSON.parse(JSON.stringify(this.pricingRules)),this.pricingRules=[]),this.feeRules.length>0&&(a.fee_rules=JSON.parse(JSON.stringify(this.feeRules)),this.feeRules=[]),this.fieldRules.length>0&&(a.field_rules=JSON.parse(JSON.stringify(this.fieldRules)),this.fieldRules=[]),this.colorImage.length>0&&(a.color_image=JSON.parse(JSON.stringify(this.colorImage)),this.colorImage=[])}return a},this.fetchRules=function(b,c){var a={},f="",d="",e="",g=b.closest(".wcff-meta-row").attr("data-type");if(a.expected_value={},a.amount=b.find("input.wcff-"+c+"-rules-amount").val(),"pricing"==c&&(a.ptype=b.find("div.calculation-mode > a.selected").data("ptype"),a.tprice=b.find("div.amount-mode > a.selected").data("tprice")),"fee"==c&&(a.tprice=b.find("div.amount-mode > a.selected").data("tprice"),a.is_tx=b.find("div.calculation-mode > a.selected").data("is_tx")),"fee"===c){if(a.title=this.escapeQuote(b.find("input.wcff-fee-rules-title").val()),""===a.title||!a.title)return}else if("pricing"===c){if(a.title=this.escapeQuote(b.find("input.wcff-pricing-rules-title").val()),""===a.title||!a.title)return}else if("color-image"===c)a.prev_image_url=b.find(".wcff-prev-image").attr("src"),a.image_or_url=b.find(".wcff-color-image-toggle .selected").data("type"),a.url="image"==a.image_or_url?b.find(".wcff-image-url-holder").val():b.find(".wcff-product-color-url").val(),(""==a.url.trim()||""==a.color)&&(this.val_error={flg:!0,message:"Please insert image or url in color image.",elem:b.find(".wcff-color-image-toggle .selected")});else{var i=b.find("div.wcff-"+c+"-type-of-"+("pricing"==c?"price":c)+"-toggle > a.selected");a.field_rules={};for(var h=0;h<i.length;h++)a.field_rules[$(i[h]).data("field_label")]=$(i[h]).data("vfield")}"datepicker"===g?(f=b.find("ul.wcff-"+c+"-date-type-header > li.selected").attr("data-dtype"),a.expected_value.dtype=f,a.expected_value.value=null,"days"===f?a.expected_value.value=b.find("input[type=checkbox]:checked").map(function(){return this.value}).get():"specific-dates"===f?a.expected_value.value=b.find("textarea.wcff-field-type-meta-specific_dates").val():"weekends-weekdays"===f?a.expected_value.value=b.find(".wcff-field-type-meta-weekend_weekdays:checked").val():a.expected_value.value=b.find("textarea.wcff-field-type-meta-specific_date_each_months").val(),null!==a.expected_value.value&&""!==a.amount&&("pricing"===c?this.pricingRules.push(a):"fee"===c?this.feeRules.push(a):this.fieldRules.push(a))):"select"===g||"radio"===g?(d=b.find("select.wcff-"+c+"-choice-expected-value").val(),e=b.find("select.wcff-"+c+"-choice-condition-value").val(),""!==d&&""!==e&&""!==a.amount&&(a.expected_value=d,a.logic=e,"pricing"===c?this.pricingRules.push(a):"fee"===c?this.feeRules.push(a):this.fieldRules.push(a))):"checkbox"===g?(d=[],d=b.find("input[type=checkbox]:checked").map(function(){return this.value}).get(),e=b.find("select.wcff-"+c+"-multi-choice-condition-value").val(),d.length>0&&""!==e&&""!==a.amount&&(a.expected_value=d,a.logic=e,"pricing"===c?this.pricingRules.push(a):"fee"===c?this.feeRules.push(a):this.fieldRules.push(a))):(d=b.find("input.wcff-"+c+"-input-expected-value").val(),e=b.find("select.wcff-"+c+"-input-condition-value").val(),"color-image"===c&&(d=b.find(".wcff-color-image-select-container input:checked").val()),(""!==a.amount||"null"==e)&&(a.expected_value=d,a.logic=e,"pricing"===c?this.pricingRules.push(a):"fee"===c?this.feeRules.push(a):"color-image"===c?this.colorImage.push(a):this.fieldRules.push(a)))},this.loadFieldList=function(c){if("yes"==c.use_custom_layout?($("input[name=wcff_use_custom_layout]").prop("checked",!0),$("#wcff-layout-designer-pad").css("opacity","1").css("pointer-events","auto"),$("#wcff-layout-designer-field-list").css("opacity","1").css("pointer-events","auto")):($("input[name=wcff_use_custom_layout]").prop("checked",!1),$("#wcff-layout-designer-pad").css("opacity",".5").css("pointer-events","none"),$("#wcff-layout-designer-field-list").css("opacity",".5").css("pointer-events","none")),c.fields){var a=0,e=!0,b=Object.keys(c.fields),d=$("#wcff-layout-designer-field-list");for(d.html(""),this.fields=c.fields,this.layout=c.layout,$.isEmptyObject(this.layout)||Array.isArray(this.layout)&&0==this.layout.length||""==this.layout?(this.layout={},this.layout.rows=[[]],this.layout.columns={}):this.layout.columns?Array.isArray(this.layout.columns)&&(this.layout.columns={}):(this.layout.columns={},this.layout.rows=[]),a=0;a<b.length;a++)this.layout.columns[b[a]]||(e=!1,d.append($('<a href="#" draggable="true" data-fkey="'+b[a]+'" data-type="'+this.fields[b[a]].type+'" title="'+this.fields[b[a]].label+'">'+this.fields[b[a]].label+"</a>")));e&&($.isEmptyObject(this.fields)?d.html("<h3>Field List is Empty<br/>Please add some fields.!</h3>"):d.html("<h3>All fields are used.!</h3>")),this.renderLayoutDesigner()}},this.renderLayoutDesigner=function(){var a=0,b=0,c="",d=$("#wcff-layout-designer-pad");if(d.html(""),$.isEmptyObject(this.layout.columns))d.html('<div class="wcff-layout-form-row"></div>');else{for(a=0;a<this.layout.rows.length;a++){for(b=0,c='<div class="wcff-layout-form-row">';b<this.layout.rows[a].length;b++)0!=b&&(c+='<div class="handlebar"></div>'),c+='<div class="dropped" data-fkey="'+this.layout.rows[a][b]+'" style="flex-basis: '+this.layout.columns[this.layout.rows[a][b]].width+'%;"></div>';c+="</div>",d.append($(c))}this.layoutFieldsKeys=Object.keys(this.layout.columns),this.prepareRequest("GET","render_fields_for_designer",{keys:this.layoutFieldsKeys,alignment:$("input[name=wcff_label_alignment_radio]:checked").val()},null),this.ajaxFlaQ=!0,this.dock()}},this.renderLayoutField=function(c){for(let a=0;a<this.layoutFieldsKeys.length;a++){var b=$("div.dropped[data-fkey="+this.layoutFieldsKeys[a]+"]");b.length>0&&c[this.layoutFieldsKeys[a]]&&(b.html(c[this.layoutFieldsKeys[a]]),b.append($('<a href="#" class="delete-field" title="Remove">X</a>')))}},this.onPostSubmit=function(c){var d=this,e={},a={},f=[],b=[];return $(".wcff_logic_group").each(function(){f=[],$(this).find("table.wcff_rules_table tr").each(function(){(a={}).context=$(this).find("select.wcff_condition_param").val(),a.logic=$(this).find("select.wcff_condition_operator").val(),a.endpoint=$(this).find("select.wcff_condition_value").val(),f.push(a)}),b.push(f)}),(a={}).context=$("select.wcff_location_param").val(),"location_product_data"!==a.context?a.endpoint={context:$(".wcff_location_metabox_context_value").val(),priority:$(".wcff_location_metabox_priorities_value").val()}:a.endpoint=$("select.wcff_location_product_data_value").val(),$("#wcff_condition_rules").val(JSON.stringify(b)),$.isEmptyObject(a)||$("#wcff_location_rules").val(JSON.stringify(a)),$("div.wcff-meta-row.opened").each(function(){d.activeRow=$(this),(e=d.fetchFieldConfig())&&(d.dirtyFields[d.activeRow.attr("data-key")]=e)}),$.isEmptyObject(this.dirtyFields)?$("#wcff_dirty_fields_configuration").remove():$("#wcff_dirty_fields_configuration").val(JSON.stringify(this.dirtyFields)),$("#wcff_layout_meta").val(JSON.stringify(this.layout)),!0},this.reloadHtml=function(a){a.html(this.response.payload)},this.sanitizeStr=function(a){return a?a.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"_"):a},this.escapeQuote=function(a){return a&&(a=(a=a.replace(/'/g,"&#39;")).replace(/"/g,"&#34;")),a},this.unEscapeQuote=function(a){return a&&(a=(a=a.replace(/&#39;/g,"'")).replace(/&#34;/g,'"')),a},this.encode=function(b){for(var c=[],a=b.length-1;a>=0;a--)c.unshift(["&#",b[a].charCodeAt(),";"].join(""));return c.join("")},this.decode=function(a){return a.replace(/&#(\d+);/g,function(b,a){return String.fromCharCode(a)})},this.isNumberChoices=function(d){var a=!1,b=d.split("\n");if(b){a=!0;for(var c=0;c<b.length;c++)if(isNaN(b[c].split("|")[0])){a=!1;break}}return a},this.getQueryParameter=function(d){var a,b,c=window.location.search.substring(1).split("&");for(a=0;a<c.length;a++)if((b=c[a].split("="))[0]===d)return void 0===b[1]||decodeURIComponent(b[1]);return null},this.reloadMapping=function(){this.ajaxFlaQ=!0,this.mask.doUnMask(this.mapping_grid.gridTable),this.mapping_grid.bucket=this.response.payload,this.mapping_grid.prepareRecords(this.mapping_grid.bucket),this.mapping_grid.loadRecords()},this.prepareRequest=function(c,d,e,f){var a=0,b="";"undefined"!=typeof wcff_var&&(a=wcff_var.post_id,b=wcff_var.post_type),this.request={method:c,context:d,post:a,post_type:b,payload:e},this.target=f},this.prepareResponse=function(a,b,c){this.response={status:a,message:b,payload:c}},this.dock=function(){var a=this;this.ajaxFlaQ&&$.ajax({type:"POST",data:{action:"wcff_ajax",wcff_param:JSON.stringify(this.request)},dataType:"json",url:wcff_var.ajaxurl,beforeSend:function(){a.ajaxFlaQ=!1},success:function(b){a.mask.doUnMask(),a.prepareResponse(b.status,b.message,b.data),a.response.status?a.responseHandler():alert(b.message),a.ajaxFlaQ=!0},error:function(b,c,d){a.mask.doUnMask(),alert(b,c,d),a.ajaxFlaQ=!0},complete:function(){a.mask.doUnMask()}})},this.prepareSearchRequest=function(c,d,e){var a=0,b="";return"undefined"!=typeof wcff_var&&(a=wcff_var.post_id,b=wcff_var.post_type),{method:c,context:d,post:a,post_type:b,payload:e}},this.searchDock=function(a){var b=this;$.ajax({type:"POST",data:{action:"wcff_ajax",wcff_param:JSON.stringify(a)},dataType:"json",url:wcff_var.ajaxurl,success:function(d){var c={status:d.status,message:d,payload:d.data};c.status?"product_mapping"==a.payload.context?b.handleTargetProductSearch(a,c):b.handleSearch(a,c):(alert(c.message),$("div.variation-config-ghost-back").trigger("click"))},error:function(a,b,c){alert(a,b,c)}})},this.responseHandler=function(){if("product"===this.request.context||"product_cat"===this.request.context||"product_tag"===this.request.context||"product_type"===this.request.context||"product_variation"===this.request.context)this.reloadHtml(this.target.parent().parent().find("td.condition_value_td"));else if("location_product_data"===this.request.context||"location_product"===this.request.context||"location_order"===this.request.context||"location_product_cat"===this.request.context)this.reloadHtml(this.target.parent().parent().find("td.location_value_td"));else if("POST"===this.request.method&&"field"===this.request.context)this.activeRow=this.target,this.activeField=this.response.payload.meta,this.target.append(this.response.payload.widget),this.target.attr("data-key",this.response.payload.id),this.target.find("label.wcff-switch").attr("data-key",this.response.payload.id),this.target.find("a.wcff-field-delete").show().attr("data-key",this.response.payload.id),this.target.find("div.wcff_fields_factory").toggle("slow","swing"),this.prepareConfigWidget(!0),this.dirtyFields[this.activeField.key]=this.fetchFieldConfig();else if("GET"===this.request.method&&"field"===this.request.context)this.activeField=this.response.payload.meta,this.target.append(this.response.payload.widget),this.target.find("div.wcff_fields_factory").toggle("slow","swing"),this.prepareConfigWidget(!1),this.renderSingleView(),this.dirtyFields[this.activeField.key]=this.activeField;else if("PUT"===this.request.method&&"field"===this.request.context)this.dirtyFields[this.request.payload.key];else if("DELETE"===this.request.method&&"field"===this.request.context){if(this.target.closest(".wcff-meta-row").remove(),0==$("#wcff-fields-set .wcff-meta-row").length)this.emptyNotice.show();else{var a="wcccf"==wcff_var.post_type?1:0;$("div.wcff-meta-row").each(function(){!$(this).is("#wcff-add-field-placeholder")&&($(this).find("input.wcff-field-order-index").val(a),$(this).find("span.wcff-field-order-number").text("wcccf"==wcff_var.post_type?a:a+1),a++)})}}else"GET"===this.request.method&&"search"===this.request.context?("wccvf"===this.request.payload.post_type&&this.currentWccvfSearchField&&(this.wccvfPosts=this.response.payload),"product_mapping"==this.request.payload.context?this.handleTargetProductSearch(this.request,this.response):this.handleSearch(this.request,this.response)):"wcff_field_list"===this.request.context?this.loadFieldList(this.response.payload):"render_field"===this.request.context?this.handleDropField(this.response.payload):"render_fields_for_designer"===this.request.context?this.renderLayoutField(this.response.payload):"variation_fields_mapping_list"===this.request.context?(this.mapping_grid.bucket=this.response.payload,this.mapping_grid.prepareRecords(this.mapping_grid.bucket)):"DELETE"===this.request.method&&"mapping"===this.request.context?(this.mapping_grid.isReloading=!0,this.mapping_grid.reloadingFor="remove",this.mapping_grid.bucket=this.response.payload,this.mapping_grid.prepareRecords(this.mapping_grid.bucket),$("div.variation-config-ghost-back").trigger("click")):"POST"===this.request.method&&"variation_fields_map"===this.request.context?this.currentWccvfSearchField?(this.mapping_grid.isReloading=!0,this.mapping_grid.reloadingFor="add",this.mapping_grid.bucket=this.response.payload,this.reloadVariationLevelConfigPopup()):(this.reloadMapping(),$("div.variation-config-ghost-back").trigger("click")):"GET"===this.request.method&&"wcff_field_clone"===this.request.context&&(location.href="");this.target=null}},b=function(){this.top=0,this.left=0,this.bottom=0,this.right=0,this.target=null,this.mask=null,this.getPosition=function(c){this.target=c;var a=this.target.position(),b=this.target.offset();this.top=b.top,this.left=b.left,this.bottom=$(window).width()-a.left-this.target.width(),this.right=$(window).height()-a.right-this.target.height()},this.doMask=function(a){a&&(this.target=a,this.mask=$('<div class="wcff-dock-loader"></div>'),this.target.append(this.mask),this.mask.css("left","0px"),this.mask.css("top","0px"),this.mask.css("right",this.target.innerWidth()+"px"),this.mask.css("bottom",this.target.innerHeight()+"px"),this.mask.css("width",this.target.innerWidth()+"px"),this.mask.css("height",this.target.innerHeight()+"px"))},this.doUnMask=function(){this.mask&&this.mask.remove()}};$.fn.visibleHeight=function(){var a,b,c,d,e,f;return c=(d=$(window).scrollTop())+$(window).height(),a=(b=this.offset().top)+this.outerHeight(),f=b<d?d:b,e=a>c?c:a,e-f},$.fn.isExceedViewport=function(){return this.offset().top+this.outerHeight()>$(window).height()},$(document).ready(function(){(wcffObj=new a).initialize()})}(jQuery)